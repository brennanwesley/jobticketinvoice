"use strict";(self.webpackChunkjobticketinvoice_frontend=self.webpackChunkjobticketinvoice_frontend||[]).push([[945],{911:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(5043),a=r(3645),i=r(579);const o=()=>{const{language:e,toggleLanguage:t}=(0,a.ok)(),r="en"===e?"Espa\xf1ol":"English",s="es"===e?"click for":"haga clic para";return(0,i.jsxs)("button",{onClick:t,className:"absolute top-0 right-0 m-4 px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-md transition-colors flex items-center focus:outline-none focus:ring-2 focus:ring-orange-700","aria-label":"".concat(s," ").concat(r),title:"".concat(s," ").concat(r),tabIndex:0,children:[(0,i.jsx)("span",{className:"text-xs italic text-gray-400 mr-1",children:s}),(0,i.jsx)("span",{children:r})]})},l=(0,s.memo)(o)},948:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var s=r(5043),a=r(3645),i=r(3059),o=r(2807),l=(r(2376),r(579));const n=()=>{const{t:e}=(0,a.ok)(),{draftTickets:t,setSelectedDraftTicket:r,setViewMode:n,deleteDraftTicket:d,setTicketMode:m}=(0,i.yS)(),[x,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)(null),b=(0,s.useCallback)((e=>{if(!e)return"-";try{return e}catch(t){return e}}),[]),g=((0,s.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e?e.length>t?"".concat(e.substring(0,t),"..."):e:""}),[]),(0,s.useCallback)((e=>{r(e),n("draft")}),[r,n])),j=(0,s.useCallback)((e=>{h(e),u(!0)}),[h]),y=(0,s.useCallback)((()=>{p&&(r(p),m("manual"),n("form"),d(p.id)),u(!1)}),[p,r,m,n,d]),f=(0,s.useCallback)((()=>{h(null),u(!1)}),[]),k=(0,s.useCallback)((e=>{d(e)}),[d]);return(0,l.jsxs)("div",{className:"py-6 px-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:e("jobTicket.drafts")}),(0,l.jsx)(o.Zp,{className:"overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider w-24",children:e("common.edit")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-24 sm:w-auto",children:e("jobTicket.date")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-48 sm:w-1/4",children:e("jobTicket.company")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-48 sm:w-1/4",children:e("jobTicket.location")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-16 sm:w-auto",children:e("jobTicket.hours")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:e("jobTicket.description")}),(0,l.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:e("common.actions")})]})}),0===t.length?(0,l.jsx)("tbody",{children:(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"7",className:"px-6 py-4",children:(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("p",{className:"text-gray-400",children:e("jobTicket.noDrafts")})})})})}):(0,l.jsx)("tbody",{className:"divide-y divide-gray-700",children:(0,l.jsx)(o.wj,{items:t,height:400,itemHeight:64,renderItem:t=>(0,l.jsx)(c,{ticket:t,formatDate:b,handleEditTicket:j,handleViewTicket:g,handleDeleteTicket:k,t:e},t.id),overscan:5,emptyComponent:(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"7",className:"px-6 py-4",children:(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)(o.kt,{size:"md"})})})})})})]})})}),(0,l.jsx)(o.aF,{isOpen:x,onClose:f,title:e("jobTicket.editConfirmation"),size:"md",footer:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.$n,{variant:"secondary",onClick:f,children:e("common.no")}),(0,l.jsx)(o.$n,{variant:"primary",onClick:y,className:"ml-3",children:e("common.yes")})]}),children:(0,l.jsx)("p",{children:e("jobTicket.editConfirmationMessage")})})]})},c=s.memo((e=>{let{ticket:t,formatDate:r,handleEditTicket:s,handleViewTicket:a,handleDeleteTicket:i,t:n}=e;return(0,l.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:(0,l.jsx)(o.$n,{variant:"outline",size:"sm",onClick:()=>s(t),className:"text-orange-500 hover:text-orange-400 font-medium","aria-label":"".concat(n("common.edit")," ").concat(t.companyName||n("jobTicket.untitledTicket")),children:n("common.edit")})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:r(t.jobDate)}),(0,l.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,l.jsx)("div",{className:"truncate",children:t.companyName||n("jobTicket.untitledTicket")})}),(0,l.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,l.jsx)("div",{className:"truncate",children:t.location||"-"})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.workTotalHours||"0"}),(0,l.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,l.jsx)("div",{className:"truncate",children:t.workDescription||"-"})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end sm:space-x-3 space-y-2 sm:space-y-0",children:[(0,l.jsx)(o.$n,{variant:"outline",size:"sm",onClick:()=>a(t),className:"text-blue-500 hover:text-blue-400","aria-label":"".concat(n("common.view")," ").concat(t.companyName||n("jobTicket.untitledTicket")),children:n("common.view")}),(0,l.jsx)(o.$n,{variant:"outline",size:"sm",onClick:()=>i(t.id),className:"text-red-500 hover:text-red-400","aria-label":"".concat(n("common.delete")," ").concat(t.companyName||n("jobTicket.untitledTicket")),children:n("common.delete")})]})})]})})),d=s.memo(n)},3059:(e,t,r)=>{r.d(t,{Ay:()=>m,YR:()=>c,yS:()=>d});var s=r(5043),a=r(9424),i=r(6161),o=r(6207),l=r(9016);const n=(0,s.createContext)(),c=e=>{let{children:t}=e;return t},d=()=>{const e=(0,s.useContext)(n),t=(0,a.oz)(),r=(0,i.EE)(),c=(0,o.kt)(),d=(0,l.PN)(),m=(0,s.useMemo)((()=>({viewMode:d.viewMode,setViewMode:d.navigateTo,ticketMode:d.ticketMode,setTicketMode:d.setTicketMode,formData:r.formData,setFormData:r.setFormData,updateFormData:r.updateFormField,handleInputChange:r.handleInputChange,resetForm:r.resetForm,addPart:r.addPart,removePart:r.removePart,draftTickets:t.draftTickets,setDraftTickets:()=>console.warn("setDraftTickets is deprecated, use DraftTicketContext methods instead"),selectedDraftTicket:t.selectedDraftTicket,setSelectedDraftTicket:t.setSelectedDraftTicket,saveJobTicketAsDraft:t.saveDraft,deleteDraftTicket:t.deleteDraft,loadDraftIntoForm:t.loadDraftIntoForm,submitJobTicket:c.submitJobTicket,isSubmitting:c.isSubmitting,submitError:c.submitError,submitSuccess:c.submitSuccess})),[d,r,t,c]);return e||m},m=n},4111:(e,t,r)=>{r.d(t,{_P:()=>a});const s=e=>{if(!e)return!1;return/^([01]?[0-9]|2[0-3]):([0-5][0-9])$/.test(e)},a=(e,t)=>{if(!s(e)||!s(t))return null;const[r,a]=e.split(":").map(Number),[i,o]=t.split(":").map(Number);let l=i-r,n=o-a;return n<0&&(l--,n+=60),l<0&&(l+=24),parseFloat((l+n/60).toFixed(2))}},4456:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ue});var s=r(5043),a=r(3216),i=r(9265),o=r(3059),l=r(3645),n=r(579);const c=(0,s.createContext)(),d=e=>{let{children:t}=e;const{t:r}=(0,l.ok)(),[a,i]=(0,s.useState)(null),[o,d]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[u,p]=(0,s.useState)(!1),h=(0,s.useRef)(null),b=(0,s.useRef)(null);(0,s.useEffect)((()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return void console.error("Speech recognition not supported");const e=window.SpeechRecognition||window.webkitSpeechRecognition;return h.current=new e,h.current.continuous=!0,h.current.interimResults=!0,h.current.lang="en-US",()=>{if(h.current)try{h.current.stop()}catch(e){console.error("Error stopping recognition:",e)}b.current&&clearTimeout(b.current)}}),[]);const g=(0,s.useCallback)((()=>{b.current&&clearTimeout(b.current),b.current=setTimeout((()=>{u&&(y(),x(r("listeningTimeout")),i("error"))}),15e3)}),[u,r]),j=(0,s.useCallback)((()=>{if(!h.current)return x(r("browserNotSupported")),void i("error");d(""),x(""),i("listening"),p(!0);try{h.current.onstart=()=>{console.log("Voice recognition started"),g()},h.current.onresult=e=>{g();const t=Array.from(e.results).map((e=>e[0].transcript)).join(" ");d(t)},h.current.onerror=e=>{console.error("Speech recognition error",e.error),"no-speech"===e.error?x(r("noSpeechDetected")):"not-allowed"===e.error?x(r("microphoneError")):x(r("transcriptionError")),i("error"),p(!1),b.current&&clearTimeout(b.current)},h.current.onend=()=>{if(console.log("Voice recognition ended"),u&&"listening"===a)try{h.current.start()}catch(e){console.error("Error restarting recognition:",e)}else p(!1),"listening"===a&&i("captured")},h.current.start()}catch(e){console.error("Error starting voice recognition:",e),x(r("transcriptionError")),i("error"),p(!1)}}),[u,g,r,a]),y=(0,s.useCallback)((()=>{if(h.current&&u)try{h.current.stop(),console.log("Voice recognition stopped")}catch(e){console.error("Error stopping recognition:",e)}b.current&&(clearTimeout(b.current),b.current=null),p(!1),i("processing"),setTimeout((()=>{o?i("captured"):(x(r("noSpeechDetected")),i("error"))}),1e3)}),[u,r,o]),f=(0,s.useCallback)((()=>{if(h.current&&u)try{h.current.stop(),console.log("Voice recognition cancelled")}catch(e){console.error("Error stopping recognition:",e)}b.current&&(clearTimeout(b.current),b.current=null),p(!1),i(null),d(""),x("")}),[u]),k={voiceStatus:a,setVoiceStatus:i,transcribedText:o,setTranscribedText:d,transcriptionError:m,setTranscriptionError:x,isListening:u,startVoiceRecording:j,stopVoiceRecording:y,cancelVoiceRecording:f};return(0,n.jsx)(c.Provider,{value:k,children:t})},m=()=>{const e=(0,s.useContext)(c);if(!e)throw new Error("useVoice must be used within a VoiceProvider");return e};var x=r(9609),u=r(5475),p=r(4129),h=r(9938),b=r(73),g=r(2704),j=r(2807),y=r(2376);const f=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")},k={"/profile":s.lazy((()=>r.e(949).then(r.bind(r,7949)))),"/":s.lazy((()=>Promise.resolve().then(r.bind(r,6782)))),"/submitted":s.lazy((()=>Promise.resolve().then(r.bind(r,5894)))),"/drafts":s.lazy((()=>Promise.resolve().then(r.bind(r,948))))},v=(0,s.forwardRef)(((e,t)=>{let{sidebarOpen:r,setSidebarOpen:i}=e;const{t:c}=(0,l.ok)(),{viewMode:d,setViewMode:m,draftTickets:v,selectedDraftTicket:w,setSelectedDraftTicket:N,setTicketMode:T}=(0,o.yS)(),{user:S,isAuthenticated:C,logout:D}=(0,x.As)();(0,a.zy)();(0,y.Eh)(k);const E=(0,s.useCallback)((()=>{T("manual"),m("form")}),[T,m]),A=(0,s.useCallback)((()=>{m("submittedList")}),[m]),O=(0,s.useCallback)((()=>{m("draftList")}),[m]),F=(0,s.useCallback)((()=>{D()}),[D]);return(0,n.jsx)("div",{ref:t,className:f(r?"translate-x-0":"-translate-x-full","fixed top-0 left-0 z-40 h-full w-64 bg-gray-900 transition-transform duration-300 ease-in-out md:translate-x-0"),children:(0,n.jsxs)("div",{className:"flex h-full flex-col gap-y-5 overflow-y-auto px-6 py-4",children:[(0,n.jsx)("div",{className:"flex h-16 shrink-0 items-center",children:(0,n.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Job Ticket"})}),(0,n.jsx)("div",{className:"flex flex-shrink-0 items-center px-4",children:(0,n.jsx)(j._V,{className:"h-8 w-auto",src:"/logo.png",alt:"JobTicketInvoice",lazy:!1})}),C&&S&&(0,n.jsxs)("div",{className:"mt-5 flex flex-col items-center px-4 pb-5 border-b border-gray-800",children:[(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("div",{className:"h-12 w-12 rounded-full bg-slate-700 flex items-center justify-center",children:S.logo_url?(0,n.jsx)(j._V,{src:S.logo_url,alt:"User",className:"h-10 w-10 rounded-full object-cover",fallbackSrc:"",lazy:!1}):(0,n.jsx)(p.A,{className:"h-6 w-6 text-gray-400","aria-hidden":"true"})})}),(0,n.jsxs)("div",{className:"mt-3 text-center",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-400",children:c("common.loggedInAs")}),(0,n.jsx)("p",{className:"text-base font-semibold text-white truncate max-w-[200px]",children:S.name||S.email}),(0,n.jsxs)("div",{className:"mt-2 flex flex-col space-y-1",children:[(0,n.jsx)(u.N_,{to:"/profile",className:"text-xs text-orange-500 hover:text-orange-400",children:c("nav.profile")}),(0,n.jsx)("button",{onClick:F,className:"text-xs text-gray-400 hover:text-gray-300",children:c("nav.logout")})]})]})]}),(0,n.jsx)("nav",{className:"flex flex-1 flex-col",children:(0,n.jsx)("ul",{className:"flex flex-1 flex-col gap-y-7",children:(0,n.jsx)("li",{children:(0,n.jsxs)("ul",{className:"-mx-2 space-y-1",children:[(0,n.jsx)("li",{className:"mb-6",children:(0,n.jsxs)(j.$n,{onClick:E,variant:"success",fullWidth:!0,className:"flex items-center justify-center gap-x-2",children:[(0,n.jsx)(h.A,{className:"h-5 w-5","aria-hidden":"true"}),(0,n.jsx)("span",{children:c("jobTicket.createNew")})]})}),(0,n.jsx)("li",{children:(0,n.jsx)("div",{className:"text-sm font-semibold leading-6 text-white px-2 mb-3",children:c("nav.jobTickets")})}),(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:A,className:f("submittedList"===d?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800","group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold w-full text-left"),children:[(0,n.jsx)(b.A,{className:"h-6 w-6 shrink-0","aria-hidden":"true"}),c("nav.submitted")]})}),(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:O,className:f("draftList"===d?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800","group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold w-full text-left"),children:[(0,n.jsx)(g.A,{className:"h-6 w-6 shrink-0","aria-hidden":"true"}),c("nav.drafts"),v.length>0&&(0,n.jsx)("span",{className:"ml-auto w-5 h-5 rounded-full bg-orange-500 flex items-center justify-center text-xs text-white",children:v.length})]})}),!1]})})})})]})})})),w=(0,s.memo)(v);var N=r(911),T=r(4228),S=r(6510),C=r(5111);const D=()=>{const{t:e,language:t}=(0,l.ok)(),{setTicketMode:r,setViewMode:s}=(0,o.yS)(),{startVoiceRecording:a}=m();return(0,n.jsxs)("div",{className:"relative flex flex-col items-center justify-center min-h-[80vh] px-4 py-8 overflow-hidden",children:[(0,n.jsxs)("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute -top-20 -left-20 w-64 h-64 rounded-full bg-orange-500 opacity-5"}),(0,n.jsx)("div",{className:"absolute -bottom-32 -right-32 w-96 h-96 rounded-full bg-orange-500 opacity-5"}),(0,n.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:(0,n.jsx)(g.A,{className:"w-96 h-96 text-gray-700 opacity-[0.03]"})}),(0,n.jsx)("div",{className:"absolute top-1/4 right-1/4 w-20 h-20 rounded-lg rotate-45 bg-gray-600 opacity-[0.03]"}),(0,n.jsx)("div",{className:"absolute bottom-1/3 left-1/3 w-16 h-16 rounded-lg rotate-12 bg-gray-600 opacity-[0.03]"})]}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-3xl mx-auto bg-gray-900 bg-opacity-60 backdrop-filter backdrop-blur-sm rounded-2xl shadow-2xl border border-gray-800 p-8 sm:p-10",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-3",children:e("createJobTicket")}),(0,n.jsx)("p",{className:"text-gray-300 text-sm sm:text-base max-w-md mx-auto",children:"en"===t?"Select how you would like to create your job ticket":"Seleccione c\xf3mo desea crear su boleta de trabajo"})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-stretch",children:[(0,n.jsxs)("button",{onClick:()=>{r("manual"),s("form")},className:"flex flex-col items-center justify-center p-6 sm:p-8 bg-gradient-to-br from-gray-800 to-gray-900 hover:from-gray-700 hover:to-gray-800 text-white rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl border border-gray-700 hover:border-orange-500/30 w-full sm:w-1/2 group","aria-label":e("byHand"),children:[(0,n.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-full mb-4 group-hover:scale-110 transition-transform duration-300",children:(0,n.jsx)(T.A,{className:"h-8 w-8 text-white"})}),(0,n.jsx)("span",{className:"text-lg font-medium",children:e("byHand")}),(0,n.jsx)("span",{className:"text-sm text-gray-400 mt-2",children:"en"===t?"Fill out form manually":"Llenar formulario manualmente"})]}),(0,n.jsxs)("button",{onClick:()=>{r("voice"),s("form"),a()},className:"flex flex-col items-center justify-center p-6 sm:p-8 bg-gradient-to-br from-gray-800 to-gray-900 hover:from-gray-700 hover:to-gray-800 text-white rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl border border-gray-700 hover:border-orange-500/30 w-full sm:w-1/2 group","aria-label":e("byVoice"),children:[(0,n.jsx)("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-full mb-4 group-hover:scale-110 transition-transform duration-300",children:(0,n.jsx)(S.A,{className:"h-8 w-8 text-white"})}),(0,n.jsx)("span",{className:"text-lg font-medium",children:e("byVoice")}),(0,n.jsx)("span",{className:"text-sm text-gray-400 mt-2",children:"en"===t?"Create using voice commands":"Crear usando comandos de voz"})]})]})]}),(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-20",children:(0,n.jsxs)("button",{onClick:()=>{console.log("Help button clicked")},className:"flex items-center space-x-2 bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-full transition-colors shadow-lg border border-gray-700","aria-label":"Need Help?",children:[(0,n.jsx)(C.A,{className:"h-5 w-5 text-orange-500"}),(0,n.jsx)("span",{className:"text-sm",children:"en"===t?"Need Help?":"\xbfNecesita Ayuda?"})]})})]})},E=(0,s.memo)(D);var A=r(2555),O=r(2302),F=r(2455),_=r(8966),V=r(4858),M=r(4111);const H=e=>{var t;let{readOnly:r=!1,draftData:a=null}=e;const{t:i}=(0,l.ok)(),{formData:c,updateFormData:d,saveJobTicketAsDraft:m}=(0,o.yS)(),[x,u]=(0,s.useState)(""),{register:p,handleSubmit:h,control:b,setValue:g,watch:j,formState:{errors:y}}=(0,V.mN)({defaultValues:a||c}),f=j("workStartTime"),k=j("workEndTime"),v=j("travelStartTime"),w=j("travelEndTime");(0,s.useEffect)((()=>{if(f&&k){const e=(0,M._P)(f,k);null!==e&&g("workTotalHours",e)}}),[f,k,g]),(0,s.useEffect)((()=>{if(v&&w){const e=(0,M._P)(v,w);null!==e&&g("driveTotalHours",e)}}),[v,w,g]),(0,s.useEffect)((()=>{const e=j(((e,t)=>{let{name:r,type:s}=t;"change"===s&&r&&d(r,e[r])}));return()=>e.unsubscribe()}),[j,d]);const{submitJobTicket:N,isSubmitting:T,submitError:S,submitSuccess:C}=(0,o.yS)(),[D,E]=(0,s.useState)(!1),[O,F]=(0,s.useState)(!1);(0,s.useEffect)((()=>{C&&(E(!0),setTimeout((()=>E(!1)),5e3))}),[C]),(0,s.useEffect)((()=>{S&&(F(!0),setTimeout((()=>F(!1)),5e3))}),[S]);return(0,n.jsxs)("form",{onSubmit:h((async e=>{try{const t=m(e);await N(t)}catch(t){console.error("Error submitting job ticket:",t)}})),className:"space-y-8 max-w-3xl mx-auto",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"jobDate",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.date")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"date",id:"jobDate",name:"jobDate",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("jobDate",{required:!0})))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"companyName",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.companyName")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"companyName",name:"companyName",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("companyName",{required:!0})))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"customerName",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.customerName")||"Customer Name"}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"customerName",name:"customerName",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("customerName")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.location")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"location",name:"location",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("location")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workType",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.workType")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"workType",name:"workType",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("workType")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"equipment",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.equipment")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"equipment",name:"equipment",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("equipment")))})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workStartTime",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.workStartTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"time",id:"workStartTime",name:"workStartTime",className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("workStartTime")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workEndTime",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.workEndTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"time",id:"workEndTime",name:"workEndTime",className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("workEndTime")))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workTotalHours",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.workTotalTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"workTotalHours",name:"workTotalHours",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:!0},p("workTotalHours")))})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"driveStartTime",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.travelStartTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"time",id:"driveStartTime",name:"driveStartTime",className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("driveStartTime")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"driveEndTime",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.travelEndTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"time",id:"driveEndTime",name:"driveEndTime",className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("driveEndTime")))})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"driveTotalHours",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.travelTotalTime")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"driveTotalHours",name:"driveTotalHours",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:!0},p("driveTotalHours")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:i("jobTicket.travelType")}),(0,n.jsx)("div",{className:"flex space-x-4",children:(0,n.jsx)(V.xI,{name:"travelType",control:b,render:e=>{let{field:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("label",{className:"\n                  flex items-center justify-center px-3 py-2 rounded-md cursor-pointer\n                  ".concat("oneWay"===t.value?"bg-orange-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600","\n                  ").concat(r?"pointer-events-none":"","\n                "),children:[(0,n.jsx)("input",{type:"radio",value:"oneWay",className:"sr-only",disabled:r,onChange:()=>t.onChange("oneWay"),checked:"oneWay"===t.value}),(0,n.jsx)("span",{children:i("jobTicket.oneWay")})]}),(0,n.jsxs)("label",{className:"\n                  flex items-center justify-center px-3 py-2 rounded-md cursor-pointer\n                  ".concat("roundTrip"===t.value?"bg-orange-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600","\n                  ").concat(r?"pointer-events-none":"","\n                "),children:[(0,n.jsx)("input",{type:"radio",value:"roundTrip",className:"sr-only",disabled:r,onChange:()=>t.onChange("roundTrip"),checked:"roundTrip"===t.value}),(0,n.jsx)("span",{children:i("jobTicket.roundTrip")})]})]})}})})]}),(0,n.jsxs)("div",{className:"max-w-3xl",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:i("jobTicket.parts.title")}),!r&&(0,n.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,n.jsxs)("select",{value:x,onChange:e=>u(e.target.value),className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",children:[(0,n.jsx)("option",{value:"",children:i("jobTicket.parts.placeholder")}),[{value:i("jobTicket.parts.lubricant"),label:i("jobTicket.parts.lubricant")},{value:i("jobTicket.parts.pumpSeal"),label:i("jobTicket.parts.pumpSeal")},{value:i("jobTicket.parts.thrustChamber"),label:i("jobTicket.parts.thrustChamber")},{value:i("jobTicket.parts.vfdBreakerSwitch"),label:i("jobTicket.parts.vfdBreakerSwitch")},{value:i("jobTicket.parts.serviceKit"),label:i("jobTicket.parts.serviceKit")},{value:i("jobTicket.parts.other"),label:i("jobTicket.parts.other")}].map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]}),(0,n.jsx)("button",{type:"button",onClick:()=>{if(!x)return;const e=j("partsUsed")||[];g("partsUsed",[...e,x]),u("")},disabled:!x,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50",children:i("jobTicket.addPart")})]}),(0,n.jsx)("div",{className:"mt-2 space-y-2",children:null===(t=j("partsUsed"))||void 0===t?void 0:t.map(((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-gray-700 px-3 py-2 rounded-md",children:[(0,n.jsx)("span",{children:e}),!r&&(0,n.jsx)("button",{type:"button",onClick:()=>(e=>{const t=[...j("partsUsed")||[]];t.splice(e,1),g("partsUsed",t)})(t),className:"text-gray-400 hover:text-white",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t)))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workDescription",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.workDescription")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("textarea",(0,A.A)({id:"workDescription",name:"workDescription",rows:4,className:"bg-gray-800 block w-full max-w-2xl rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("workDescription")))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"submittedBy",className:"block text-sm font-medium text-gray-300",children:i("jobTicket.submittedBy")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",(0,A.A)({type:"text",id:"submittedBy",name:"submittedBy",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:r},p("submittedBy")))})]}),D&&(0,n.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[(0,n.jsxs)("strong",{className:"font-bold",children:[i("common.success"),"!"]}),(0,n.jsxs)("span",{className:"block sm:inline",children:[" ",i("jobTicket.submitted")]})]}),O&&(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[(0,n.jsxs)("strong",{className:"font-bold",children:[i("common.error"),"!"]}),(0,n.jsxs)("span",{className:"block sm:inline",children:[" ",i("jobTicket.submitError")]})]}),!r&&(0,n.jsx)("div",{className:"pt-5",children:(0,n.jsx)("div",{className:"flex justify-center sm:justify-end",children:(0,n.jsxs)("button",{type:"submit",disabled:T,className:"inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ".concat(T?"bg-gray-500":"bg-orange-600 hover:bg-orange-700"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors duration-200"),children:[i(T?"common.submitting":"jobTicket.submit"),T&&(0,n.jsxs)("svg",{className:"animate-spin ml-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})})})]})},z=(0,s.memo)(H),q=e=>{const t=[/(?:company|company name|for company|at company|with company)[:\s]+([^.,]+)/i,/(?:job|work)(?:\s+is)?(?:\s+for)?(?:\s+company)?[:\s]+([^.,]+)/i,/(?:at|for)[:\s]+([^.,]+?)(?:\s+(?:in|at|on|job|work))/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},B=e=>{const t=[/(?:customer|customer name|client|client name)[:\s]+([^.,]+)/i,/(?:for|with) customer[:\s]+([^.,]+)/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},L=e=>{const t=[/(?:location|site|address|place|facility|well|lease)[:\s]+([^.,]+)/i,/(?:at|in) (?:location|site|address|place|facility|well|lease)[:\s]+([^.,]+)/i,/(?:at|in)[:\s]+([^.,]+?)(?:\s+(?:on|for|to|performed|did|completed))/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},P=e=>{const t=[/(?:work type|type of work|job type)[:\s]+([^.,]+)/i,/(?:performed|did|completed)[:\s]+([^.,]+?)(?:\s+(?:at|on|for|work|job))/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},R=e=>{const t=[/(?:equipment|machine|pump|unit|system)[:\s]+([^.,]+)/i,/(?:worked on|serviced|repaired|maintained)[:\s]+([^.,]+?)(?:\s+(?:at|on|for|which|that))/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},I=e=>{const t=[/(?:work description|description of work|work performed|job description)[:\s]+([^.]+)/i,/(?:performed|did|completed|work included)[:\s]+([^.]+)/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return e},J=e=>{const t=[],r=["lubricant","pump seal","thrust chamber","vfd breaker","vfd switch","service kit","safety maintenance kit","maintenance kit"],s=e.match(/(?:parts used|used parts|parts|replaced|installed)[:\s]+([^.]+)/i);if(s&&s[1]){const e=s[1].toLowerCase();r.forEach((r=>{e.includes(r)&&t.push(r)}))}else r.forEach((r=>{e.includes(r)&&t.push(r)}));return t},$=e=>{const t=[/(?:submitted by|completed by|technician|tech|my name is|this is)[:\s]+([^.,]+)/i,/(?:submitted|completed)(?:\s+by)?[:\s]+([^.,]+)/i];for(const r of t){const t=e.match(r);if(t&&t[1])return t[1].trim()}return""},W=e=>{const t={},r=/(\d{1,2})(?::(\d{2}))?(?:\s*(am|pm))?/i,s=e.match(/(?:work|job)(?:\s+start(?:ed)?|\s+begin|began)(?:\s+at)?[:\s]+([^.,]+)/i);if(s&&s[1]){const e=s[1].match(r);e&&(t.workStartTime=U(e))}const a=e.match(/(?:work|job)(?:\s+end(?:ed)?|finished|complete(?:d)?)(?:\s+at)?[:\s]+([^.,]+)/i);if(a&&a[1]){const e=a[1].match(r);e&&(t.workEndTime=U(e))}const i=e.match(/(?:drive|travel|trip)(?:\s+start(?:ed)?|\s+begin|began)(?:\s+at)?[:\s]+([^.,]+)/i);if(i&&i[1]){const e=i[1].match(r);e&&(t.driveStartTime=U(e))}const o=e.match(/(?:drive|travel|trip)(?:\s+end(?:ed)?|finished|complete(?:d)?)(?:\s+at)?[:\s]+([^.,]+)/i);if(o&&o[1]){const e=o[1].match(r);e&&(t.driveEndTime=U(e))}return t},U=e=>{let t=parseInt(e[1],10);const r=e[2]?e[2]:"00",s=e[3]?e[3].toLowerCase():null;return"pm"===s&&t<12?t+=12:"am"===s&&12===t&&(t=0),"".concat(t.toString().padStart(2,"0"),":").concat(r.padStart(2,"0"))},Z=e=>e.includes("one way")||e.includes("oneway")||e.includes("one-way")?"oneWay":e.includes("round trip")||e.includes("roundtrip")||e.includes("round-trip")?"roundTrip":"",K=e=>{const t=e.match(/(\d{1,2})[-./](\d{1,2})[-./](\d{2,4})/);if(t){const e=parseInt(t[1],10),r=parseInt(t[2],10);let s=parseInt(t[3],10);return s<100&&(s+=2e3),"".concat(s,"-").concat(e.toString().padStart(2,"0"),"-").concat(r.toString().padStart(2,"0"))}const r=e.match(/(?:date|job date|on)[:\s]+([^.,]+)/i);if(r&&r[1]){const e=r[1].toLowerCase(),t=new Date;if(e.includes("today"))return Y(t);if(e.includes("yesterday")){const e=new Date(t);return e.setDate(e.getDate()-1),Y(e)}if(e.includes("tomorrow")){const e=new Date(t);return e.setDate(e.getDate()+1),Y(e)}}return Y(new Date)},Y=e=>{const t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(s)},G=()=>{const{translations:e,t:t}=(0,l.ok)(),{voiceStatus:r,transcribedText:a,transcriptionError:i,startVoiceRecording:c,stopVoiceRecording:d,cancelVoiceRecording:x}=m(),{setTicketMode:u,setViewMode:p,saveJobTicketAsDraft:h,setSelectedDraftTicket:b,updateFormData:g}=(0,o.yS)(),[j,y]=(0,s.useState)({});(0,s.useEffect)((()=>{if(a&&"captured"===r){const e=(e=>{if(!e)return{};const t=e.toLowerCase().trim(),r={};r.companyName=q(t),r.customerName=B(t),r.location=L(t),r.workType=P(t),r.equipment=R(t),r.workDescription=I(t),r.partsUsed=J(t),r.submittedBy=$(t);const s=W(t);return s.workStartTime&&(r.workStartTime=s.workStartTime),s.workEndTime&&(r.workEndTime=s.workEndTime),s.driveStartTime&&(r.driveStartTime=s.driveStartTime),s.driveEndTime&&(r.driveEndTime=s.driveEndTime),r.travelType=Z(t),r.jobDate=K(t),r})(a);console.log("Parsed job ticket data:",e),y(e),Object.entries(e).forEach((e=>{let[t,r]=e;r&&g(t,r)}))}}),[a,r,g]);const f=()=>{u(null),p("landing"),x()};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("button",{onClick:f,className:"flex items-center text-gray-400 hover:text-white mb-6",children:[(0,n.jsx)(F.A,{className:"h-4 w-4 mr-1"}),e.back]}),"listening"===r&&(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("p",{className:"text-2xl md:text-3xl font-bold text-orange-500 mb-8",children:e.speakJobTicketInfo}),(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsx)("div",{className:"pulse-dot",children:(0,n.jsx)(S.A,{className:"h-20 w-20 mx-auto mb-4 text-orange-500"})}),(0,n.jsxs)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 -z-10",children:[(0,n.jsx)("div",{className:"h-24 w-24 rounded-full bg-orange-500 opacity-20 pulse-ring"}),(0,n.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 h-32 w-32 rounded-full bg-orange-500 opacity-10 pulse-ring animation-delay-300"}),(0,n.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 h-40 w-40 rounded-full bg-orange-500 opacity-5 pulse-ring animation-delay-600"})]})]}),(0,n.jsxs)("div",{className:"waveform mb-8",children:[(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"}),(0,n.jsx)("div",{className:"waveform-bar"})]}),(0,n.jsx)("p",{className:"text-xl font-medium mb-6",children:e.listening}),(0,n.jsxs)("div",{className:"flex flex-col space-y-4 items-center",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-center gap-4",children:[(0,n.jsxs)("button",{onClick:d,className:"bg-orange-700 hover:bg-orange-800 text-white px-6 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[(0,n.jsx)(O.A,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:e.stopRecording})]}),(0,n.jsx)("button",{onClick:x,className:"bg-gray-700 hover:bg-gray-800 text-white px-6 py-2 rounded-lg transition-colors",children:e.cancelRecording})]}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 mt-4",children:[(0,n.jsxs)("button",{onClick:c,className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[(0,n.jsx)(S.A,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:e.restartRecording})]}),(0,n.jsxs)("button",{onClick:d,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[(0,n.jsx)(T.A,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:e.allDoneCreateJobTicket})]})]})]})]}),"processing"===r&&(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("svg",{className:"animate-spin h-10 w-10 text-orange-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,n.jsx)("p",{className:"text-xl font-medium",children:e.processingAudio})]}),"error"===r&&(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-red-500 mb-4",children:(0,n.jsx)(_.A,{className:"h-16 w-16 mx-auto"})}),(0,n.jsx)("p",{className:"text-xl font-medium text-red-500 mb-4",children:i}),(0,n.jsx)("button",{onClick:()=>u(null),className:"bg-orange-700 hover:bg-orange-800 text-white px-6 py-2 rounded-lg transition-colors",children:e.goBack})]}),"captured"===r&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:t("jobTicket.voiceCaptured")}),(0,n.jsxs)("button",{onClick:f,className:"bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[(0,n.jsx)(F.A,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:t("jobTicket.goBack")})]})]}),(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 mb-8 border-2 border-orange-500",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-3 text-orange-500",children:t("jobTicket.rawTranscription")}),(0,n.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-lg max-h-60 overflow-y-auto",children:(0,n.jsx)("p",{className:"text-gray-900 dark:text-gray-100 text-lg",children:a||t("jobTicket.noTranscriptionAvailable")})})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4 justify-center mb-8",children:[(0,n.jsxs)("button",{onClick:c,className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center space-x-2 text-lg",children:[(0,n.jsx)(S.A,{className:"h-6 w-6"}),(0,n.jsx)("span",{children:t("jobTicket.restartRecording")})]}),(0,n.jsxs)("button",{onClick:()=>{const e=h((0,A.A)((0,A.A)({},j),{},{workDescription:a}));b(e),p("draft")},className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center space-x-2 text-lg",children:[(0,n.jsx)(T.A,{className:"h-6 w-6"}),(0,n.jsx)("span",{children:t("jobTicket.submit")})]})]}),(0,n.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6 border border-gray-700",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>{const e=document.getElementById("extractedDataDetails");e&&(e.open=!e.open)},children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:t("jobTicket.extractedData")}),(0,n.jsx)("span",{className:"text-sm text-gray-400",children:"(Click to expand/collapse)"})]}),(0,n.jsxs)("details",{id:"extractedDataDetails",className:"mt-2",children:[(0,n.jsx)("summary",{className:"sr-only",children:"Extracted Data Details"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pl-4 border-l-2 border-gray-700",children:[Object.entries(j).map((e=>{let[t,r]=e;if(!r||Array.isArray(r)&&0===r.length)return null;const s=t.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase())),a=Array.isArray(r)?r.join(", "):r;return(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsxs)("span",{className:"font-medium text-gray-400 mr-2",children:[s,":"]}),(0,n.jsx)("span",{className:"text-white",children:a})]},t)})),(0,n.jsxs)("div",{className:"col-span-2 mt-4 flex items-center",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-400 mr-2",children:[t("jobTicket.recognitionQuality"),":"]}),(0,n.jsx)("div",{className:"flex space-x-1",children:Object.keys(j).filter((e=>!!j[e])).length>=5?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,n.jsx)("span",{className:"ml-2 text-green-500 text-xs",children:"Good"})]}):Object.keys(j).filter((e=>!!j[e])).length>=3?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-500"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-500"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-600"}),(0,n.jsx)("span",{className:"ml-2 text-yellow-500 text-xs",children:"Fair"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-600"}),(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-600"}),(0,n.jsx)("span",{className:"ml-2 text-red-500 text-xs",children:"Poor"})]})})]})]})]})]}),(0,n.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6 border border-gray-700",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>{const e=document.getElementById("jobTicketFormDetails");e&&(e.open=!e.open)},children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:t("jobTicket.editForm")}),(0,n.jsx)("span",{className:"text-sm text-gray-400",children:"(Click to expand/collapse)"})]}),(0,n.jsxs)("details",{id:"jobTicketFormDetails",className:"mt-2",children:[(0,n.jsx)("summary",{className:"sr-only",children:"Job Ticket Form"}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)(z,{})})]})]})]})]})},Q=(0,s.memo)(G);var X=r(948),ee=r(5894);const te=e=>{let{children:t,onSubmit:r,readOnly:a=!1,draftData:i=null}=e;const{t:c}=(0,l.ok)(),{formData:d,updateFormData:m,saveJobTicketAsDraft:u,submitJobTicket:p,isSubmitting:h,submitError:b,submitSuccess:g}=(0,o.yS)(),{user:f}=(0,x.As)(),k=(0,s.useMemo)((()=>i||d||{}),[i,d]),{register:v,handleSubmit:w,control:N,setValue:T,watch:S,formState:{errors:C}}=(0,V.mN)({defaultValues:k,mode:"onChange"}),D=S("workStartTime"),E=S("workEndTime"),O=S("driveStartTime"),F=S("driveEndTime"),_=(0,y.d7)(D,300),H=(0,y.d7)(E,300),z=(0,y.d7)(O,300),q=(0,y.d7)(F,300),B=(0,s.useCallback)((()=>_&&H?(0,M._P)(_,H):null),[_,H]),L=(0,s.useCallback)((()=>z&&q?(0,M._P)(z,q):null),[z,q]);(0,s.useEffect)((()=>{const e=B();null!==e&&T("workTotalHours",e)}),[B,T]),(0,s.useEffect)((()=>{const e=L();null!==e&&T("driveTotalHours",e)}),[L,T]),(0,s.useEffect)((()=>{const e=S(((e,t)=>{let{name:r,type:s}=t;if("change"===s&&r){const t=setTimeout((()=>{m(r,e[r])}),500);return()=>clearTimeout(t)}}));return()=>e.unsubscribe()}),[S,m]);const[P,R]=(0,s.useState)(!1),[I,J]=(0,s.useState)(!1);(0,s.useEffect)((()=>{g&&(R(!0),setTimeout((()=>R(!1)),5e3))}),[g]),(0,s.useEffect)((()=>{b&&(J(!0),setTimeout((()=>J(!1)),5e3))}),[b]);const $=(0,s.useCallback)((async e=>{try{const t=u(e);if(r)return void await r(t);await p(t)}catch(t){console.error("Error submitting job ticket:",t)}}),[r,u,p]);(0,s.useEffect)((()=>{null!==f&&void 0!==f&&f.name&&!S("submittedBy")&&T("submittedBy",f.name)}),[f,T,S]);const W=(0,s.useMemo)((()=>performance.now()),[]);return(0,s.useEffect)((()=>{const e=performance.now()-W;return console.log("BaseJobTicketForm rendered in ".concat(e.toFixed(2),"ms")),()=>{performance.clearMarks("base-job-ticket-form-render")}}),[W]),(0,n.jsxs)(j.lV,{onSubmit:w($),className:"space-y-8 max-w-3xl mx-auto",children:[(0,n.jsx)(j.pd,{label:c("jobTicket.date"),type:"date",id:"jobDate",name:"jobDate",register:v,rules:{required:!0},error:C.jobDate,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.companyName"),type:"text",id:"companyName",name:"companyName",register:v,rules:{required:!0},error:C.companyName,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.customerName"),type:"text",id:"customerName",name:"customerName",register:v,error:C.customerName,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.location"),type:"text",id:"location",name:"location",register:v,error:C.location,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.workType"),type:"text",id:"workType",name:"workType",register:v,error:C.workType,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.equipment"),type:"text",id:"equipment",name:"equipment",register:v,error:C.equipment,readOnly:a}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsx)(j.pd,{label:c("jobTicket.workStartTime"),type:"time",id:"workStartTime",name:"workStartTime",register:v,error:C.workStartTime,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.workEndTime"),type:"time",id:"workEndTime",name:"workEndTime",register:v,error:C.workEndTime,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.workTotalHours"),type:"text",id:"workTotalHours",name:"workTotalHours",register:v,readOnly:!0})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsx)(j.pd,{label:c("jobTicket.driveStartTime"),type:"time",id:"driveStartTime",name:"driveStartTime",register:v,error:C.driveStartTime,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.driveEndTime"),type:"time",id:"driveEndTime",name:"driveEndTime",register:v,error:C.driveEndTime,readOnly:a}),(0,n.jsx)(j.pd,{label:c("jobTicket.driveTotalHours"),type:"text",id:"driveTotalHours",name:"driveTotalHours",register:v,readOnly:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workDescription",className:"block text-sm font-medium text-gray-300",children:c("jobTicket.descriptionOfWork")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("textarea",(0,A.A)({id:"workDescription",name:"workDescription",rows:4,className:"bg-gray-800 block w-full max-w-2xl rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",readOnly:a},v("workDescription")))})]}),(0,n.jsx)(j.pd,{label:c("jobTicket.submittedBy"),type:"text",id:"submittedBy",name:"submittedBy",register:v,error:C.submittedBy,readOnly:a}),t,P&&(0,n.jsxs)(j.Zp,{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:[(0,n.jsxs)("strong",{className:"font-bold",children:[c("common.success"),"!"]}),(0,n.jsxs)("span",{className:"block sm:inline",children:[" ",c("jobTicket.submitted")]})]}),I&&(0,n.jsxs)(j.Zp,{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:[(0,n.jsxs)("strong",{className:"font-bold",children:[c("common.error"),"!"]}),(0,n.jsxs)("span",{className:"block sm:inline",children:[" ",c("jobTicket.submitError")]})]}),!a&&(0,n.jsx)("div",{className:"pt-5",children:(0,n.jsx)("div",{className:"flex justify-center sm:justify-end",children:(0,n.jsx)(j.$n,{type:"submit",disabled:h,variant:h?"disabled":"primary",size:"lg",children:h?(0,n.jsxs)("div",{className:"flex items-center",children:[c("common.submitting"),(0,n.jsx)(j.kt,{size:"sm",className:"ml-2"})]}):c("jobTicket.submit")})})})]})},re=s.memo(te),se=e=>{let{readOnly:t=!1,draftData:r=null}=e;const{t:a}=(0,l.ok)(),{control:i,register:o,watch:c,setValue:d}=(0,V.mN)({defaultValues:r||{}}),[m,x]=(0,s.useState)(""),u=(0,s.useMemo)((()=>[{value:a("parts.lubricant"),label:a("parts.lubricant")},{value:a("parts.pumpSeal"),label:a("parts.pumpSeal")},{value:a("parts.thrustChamber"),label:a("parts.thrustChamber")},{value:a("parts.vfdBreaker"),label:a("parts.vfdBreaker")},{value:a("parts.serviceKit"),label:a("parts.serviceKit")},{value:a("parts.other"),label:a("parts.other")}]),[a]),p=(0,s.useCallback)((()=>{if(!m)return;const e=c("parts")||[];d("parts",[...e,m]),x("")}),[m,c,d]),h=(0,s.useCallback)((e=>{const t=[...c("parts")||[]];t.splice(e,1),d("parts",t)}),[c,d]),b=(0,s.useCallback)((e=>{x(e.target.value)}),[]),g=(0,s.useMemo)((()=>{const e=c("parts")||[];return 0===e.length?(0,n.jsx)("li",{className:"text-gray-500 text-center py-2",children:a("jobTicket.noParts")}):e.map(((e,r)=>(0,n.jsxs)("li",{className:"flex items-center justify-between bg-gray-700 rounded px-3 py-2",children:[(0,n.jsx)("span",{children:e}),!t&&(0,n.jsx)(j.$n,{variant:"danger",size:"sm",onClick:()=>h(r),children:a("common.remove")})]},r)))}),[c,a,t,h]);return(0,n.jsxs)(re,{readOnly:t,draftData:r,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"workType",className:"block text-sm font-medium text-gray-300",children:a("jobTicket.workType")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsxs)("select",(0,A.A)((0,A.A)({id:"workType",name:"workType",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",disabled:t},o("workType")),{},{children:[(0,n.jsx)("option",{value:"",children:a("common.select")}),(0,n.jsx)("option",{value:"maintenance",children:a("workTypes.maintenance")}),(0,n.jsx)("option",{value:"repair",children:a("workTypes.repair")}),(0,n.jsx)("option",{value:"installation",children:a("workTypes.installation")}),(0,n.jsx)("option",{value:"inspection",children:a("workTypes.inspection")})]}))})]}),(0,n.jsx)(j.pd,{label:a("jobTicket.equipment"),type:"text",id:"equipment",name:"equipment",register:o,placeholder:a("jobTicket.equipmentPlaceholder"),readOnly:t}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:a("jobTicket.partsUsed")}),!t&&(0,n.jsxs)("div",{className:"flex items-end space-x-2 mb-3",children:[(0,n.jsx)("div",{className:"flex-grow",children:(0,n.jsxs)("select",{value:m,onChange:b,className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",children:[(0,n.jsx)("option",{value:"",children:a("common.select")}),u.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}),(0,n.jsx)(j.$n,{type:"button",variant:"primary",size:"md",onClick:p,disabled:!m,children:a("common.add")})]}),(0,n.jsx)(j.Zp,{className:"bg-gray-800 p-3 min-h-[100px] max-h-[200px] overflow-y-auto",children:(0,n.jsx)(V.xI,{name:"parts",control:i,defaultValue:[],render:e=>{let{field:t}=e;return(0,n.jsx)("ul",{className:"space-y-2",children:g})}})})]})]})},ae=s.memo(se),ie=e=>{let{readOnly:t=!1,draftData:r=null}=e;const{t:a}=(0,l.ok)(),{register:i,formState:{errors:o}}=(0,V.mN)({defaultValues:r||{}}),c=(0,s.useMemo)((()=>[{value:"",label:a("common.select")},{value:"truck",label:a("vehicleTypes.truck")||"Truck"},{value:"van",label:a("vehicleTypes.van")||"Van"},{value:"car",label:a("vehicleTypes.car")||"Car"}]),[a]),d=(0,s.useMemo)((()=>performance.now()),[]);return s.useEffect((()=>{const e=performance.now()-d;return console.log("DriverTicketForm rendered in ".concat(e.toFixed(2),"ms")),()=>{performance.clearMarks("driver-ticket-form-render")}}),[d]),(0,n.jsxs)(re,{readOnly:t,draftData:r,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"vehicleType",className:"block text-sm font-medium text-gray-300",children:a("jobTicket.vehicleType")||"Vehicle Type"}),(0,n.jsxs)("div",{className:"mt-1",children:[(0,n.jsx)("select",(0,A.A)((0,A.A)({id:"vehicleType",name:"vehicleType",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",disabled:t},i("vehicleType",{required:!0})),{},{children:c.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))})),o.vehicleType&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-500",children:a("validation.required")})]})]}),(0,n.jsx)(j.pd,{label:a("jobTicket.mileage")||"Mileage",type:"number",id:"mileage",name:"mileage",register:i,rules:{required:!0,min:0},error:o.mileage,placeholder:a("jobTicket.mileagePlaceholder")||"Enter total miles driven",readOnly:t}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"tripType",className:"block text-sm font-medium text-gray-300",children:a("jobTicket.tripType")||"Trip Type"}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsxs)("select",(0,A.A)((0,A.A)({id:"tripType",name:"tripType",className:"bg-gray-800 block w-full max-w-md rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",disabled:t},i("tripType")),{},{children:[(0,n.jsx)("option",{value:"",children:a("common.select")}),(0,n.jsx)("option",{value:"local",children:a("tripTypes.local")||"Local"}),(0,n.jsx)("option",{value:"longHaul",children:a("tripTypes.longHaul")||"Long Haul"})]}))})]})]})},oe=s.memo(ie);var le=r(6782);const ne=()=>{const{user:e}=(0,x.As)(),{t:t}=(0,l.ok)(),{selectedDraftTicket:r,ticketMode:a}=(0,o.yS)(),i=(0,s.useMemo)((()=>({pump_tech:ae,driver:oe,manual:le.default})),[]),c=(0,s.useMemo)((()=>{if("manual"===a)return"manual";if(!e||!e.job_type)return"pump_tech";const t=e.job_type.toLowerCase().replace(/[\s_-]/g,"_");return{pump_technician:"pump_tech",pumptechnician:"pump_tech",pumptech:"pump_tech",pump_service_technician:"pump_tech",pump_service_tech:"pump_tech"}[t]||t}),[e,a]),d=(0,s.useMemo)((()=>i[c]||ae),[i,c]),m=(0,s.useMemo)((()=>r||{}),[r]),u=(0,s.useMemo)((()=>performance.now()),[]);return s.useEffect((()=>{const e=performance.now()-u;return console.log("JobTicketForm (".concat(c,") rendered in ").concat(e.toFixed(2),"ms")),()=>{performance.clearMarks("form-render-".concat(c))}}),[u,c]),(0,n.jsxs)("div",{className:"py-6 px-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:t("jobTicket.createNew")}),r&&(0,n.jsxs)(j.Zp,{className:"bg-blue-500 bg-opacity-20 border border-blue-500 text-blue-500 px-4 py-3 mb-6",children:[(0,n.jsx)("p",{children:t("jobTicket.editingDraft")}),(0,n.jsxs)("p",{className:"text-sm mt-1",children:[t("jobTicket.draftId"),": ",r.id.substring(0,8)]})]}),(0,n.jsx)(s.Suspense,{fallback:(0,n.jsx)("div",{className:"flex justify-center py-8",children:(0,n.jsx)(j.kt,{size:"lg"})}),children:(0,n.jsx)(d,{draftData:m})})]})},ce=s.memo(ne),de=()=>{const{t:e}=(0,l.ok)(),{selectedDraftTicket:t,setViewMode:r,setSelectedDraftTicket:a}=(0,o.yS)(),{user:i}=(0,x.As)(),c=(0,s.useCallback)((()=>{r("draftList"),a(null)}),[r,a]),d=(0,s.useMemo)((()=>{if(!i||!i.job_type)return ae;const e=i.job_type.toLowerCase().replace(/[\s_-]/g,"_");return{pump_tech:ae,pump_technician:ae,pumptechnician:ae,pump_service_technician:ae,driver:oe}[e]||ae}),[i]),m=(0,s.useMemo)((()=>t||{}),[t]);return m.id?(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("button",{onClick:c,className:"absolute top-0 left-0 text-white flex items-center space-x-1 hover:text-gray-300 transition-colors","aria-label":e("common.goBack"),children:[(0,n.jsx)(F.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"text-sm",children:e("common.goBack")})]}),(0,n.jsxs)("div",{className:"pt-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("p",{className:"text-sm text-orange-500 italic",children:e("jobTicket.readOnlyMode")}),(0,n.jsxs)("p",{className:"text-sm text-gray-400",children:[e("jobTicket.draftId"),": ",m.id.substring(0,8)]})]}),(0,n.jsx)(d,{readOnly:!0,draftData:m})]})]}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,n.jsx)("p",{className:"text-gray-400 mb-4",children:e("jobTicket.noTicketSelected")}),(0,n.jsx)(j.$n,{variant:"primary",onClick:c,children:e("jobTicket.returnToDrafts")})]})},me=s.memo(de),xe=()=>{const{viewMode:e,ticketMode:t}=s.useContext(r(3059).Ay);return(0,n.jsxs)(n.Fragment,{children:["draftList"===e&&(0,n.jsx)(X.default,{}),"submittedList"===e&&(0,n.jsx)(ee.default,{}),"landing"===e&&null===t&&(0,n.jsx)(E,{}),"form"===e&&"voice"===t&&(0,n.jsx)(Q,{}),"form"===e&&"manual"===t&&(0,n.jsx)(ce,{}),"draft"===e&&(0,n.jsx)(me,{})]})},ue=()=>{const[e,t]=(0,s.useState)(!1),r=(0,s.useRef)(),l=(0,s.useRef)();return(0,s.useEffect)((()=>{const s=s=>{window.innerWidth>=768||e&&l.current&&!l.current.contains(s.target)&&r.current&&!r.current.contains(s.target)&&t(!1)};return document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}}),[e]),(0,n.jsx)(o.YR,{children:(0,n.jsx)(d,{children:(0,n.jsxs)("div",{className:"bg-slate-900 min-h-screen",children:[(0,n.jsx)("div",{className:"h-14 relative",children:(0,n.jsx)(N.A,{})}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("button",{ref:r,className:"md:hidden fixed top-4 left-4 z-50 p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700",onClick:()=>t(!e),children:(0,n.jsx)(i.A,{className:"h-6 w-6","aria-hidden":"true"})}),(0,n.jsx)(w,{sidebarOpen:e,setSidebarOpen:t,ref:l}),(0,n.jsx)("main",{className:"flex-1 bg-slate-900 p-6 overflow-y-auto text-white",children:(0,n.jsx)("div",{className:"mt-2 md:mt-0 pl-14 md:pl-0 md:ml-64",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsx)(a.BV,{children:(0,n.jsx)(a.qh,{path:"/",element:(0,n.jsx)(xe,{})})})})})})]})]})})})}},5894:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var s=r(5043),a=r(3645),i=r(9609),o=r(2376),l=r(2807),n=r(3867),c=r(579);const d=()=>{const{t:e}=(0,a.ok)(),{user:t}=(0,i.As)(),{data:r,isLoading:d,error:x,refetch:u}=(0,o.Wl)("/api/job-tickets/submitted",{cacheTime:18e4,onError:e=>console.error("Error fetching submitted tickets:",e)}),p=(null===r||void 0===r?void 0:r.data)||[],h=x?e("errors.fetchFailed"):null,b=(0,s.useCallback)((e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(t){return e}}),[]),g=((0,s.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e?e.length>t?"".concat(e.substring(0,t),"..."):e:""}),[]),(0,s.useCallback)((e=>{console.log("View ticket:",e)}),[])),j=(0,s.useMemo)((()=>p||[]),[p]);return(0,c.jsxs)("div",{className:"py-6 px-4",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:e("jobTicket.submitted")}),d?(0,c.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,c.jsx)(l.kt,{size:"lg",variant:"primary"})}):(0,c.jsx)(l.Zp,{className:"overflow-hidden",children:(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-24 sm:w-auto",children:e("jobTicket.date")}),(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-48 sm:w-1/4",children:e("jobTicket.company")}),(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-48 sm:w-1/4",children:e("jobTicket.location")}),(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider w-16 sm:w-auto",children:e("jobTicket.hours")}),(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:e("jobTicket.description")}),(0,c.jsx)("th",{className:"sticky top-0 bg-gray-800 px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider w-20",children:e("common.actions")})]})}),h?(0,c.jsx)("tbody",{children:(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:"6",className:"px-6 py-4",children:(0,c.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-red-500",children:[(0,c.jsx)(n.A,{className:"h-5 w-5"}),(0,c.jsx)("span",{children:h}),(0,c.jsx)(l.$n,{variant:"outline",size:"sm",onClick:()=>u(),className:"ml-3",children:e("common.retry")})]})})})}):0===j.length?(0,c.jsx)("tbody",{children:(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:"6",className:"px-6 py-4",children:(0,c.jsx)("div",{className:"text-center py-8",children:(0,c.jsx)("p",{className:"text-gray-400",children:e("jobTicket.noSubmitted")})})})})}):(0,c.jsx)("tbody",{className:"divide-y divide-gray-700",children:(0,c.jsx)(l.wj,{items:j,height:400,itemHeight:64,renderItem:t=>(0,c.jsx)(m,{ticket:t,formatDate:b,handleViewTicket:g,t:e},t.id),overscan:5,emptyComponent:(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:"6",className:"px-6 py-4",children:(0,c.jsx)("div",{className:"text-center py-8",children:(0,c.jsx)(l.kt,{size:"md"})})})})})})]})})})]})},m=s.memo((e=>{let{ticket:t,formatDate:r,handleViewTicket:a,t:i}=e;const o=(0,s.useMemo)((()=>parseFloat(t.work_total_hours||0)+parseFloat(t.travel_total_hours||0)),[t.work_total_hours,t.travel_total_hours]);return(0,c.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:r(t.job_date)}),(0,c.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,c.jsx)("div",{className:"truncate",children:t.company_name||i("jobTicket.untitledTicket")})}),(0,c.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,c.jsx)("div",{className:"truncate",children:t.location||"-"})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:o}),(0,c.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,c.jsx)("div",{className:"truncate",children:t.description||"-"})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:(0,c.jsx)(l.$n,{variant:"outline",size:"sm",onClick:()=>a(t.id),className:"text-orange-500 hover:text-orange-400","aria-label":"".concat(i("common.view")," ").concat(t.company_name||i("jobTicket.untitledTicket")),children:i("common.view")})})]})})),x=s.memo(d)},6782:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var s=r(2555),a=r(5043),i=r(4858),o=r(3645),l=r(3059),n=r(4111),c=r(2807),d=r(2376),m=r(579);const x=e=>{var t,r;let{readOnly:x=!1,draftData:u=null}=e;const{t:p}=(0,o.ok)(),{formData:h,updateFormData:b,saveJobTicketAsDraft:g}=(0,l.yS)(),[j,y]=(0,a.useState)(""),{register:f,handleSubmit:k,control:v,setValue:w,watch:N,formState:{errors:T}}=(0,i.mN)({defaultValues:u||h,mode:"onChange"}),S=N("workStartTime"),C=N("workEndTime"),D=N("driveStartTime"),E=N("driveEndTime"),A=(0,d.d7)(S,300),O=(0,d.d7)(C,300),F=(0,d.d7)(D,300),_=(0,d.d7)(E,300);(0,a.useEffect)((()=>{if(A&&O){const e=(0,n._P)(A,O);null!==e&&w("workTotalHours",e)}}),[A,O,w]),(0,a.useEffect)((()=>{if(F&&_){const e=(0,n._P)(F,_);null!==e&&w("driveTotalHours",e)}}),[F,_,w]),(0,a.useEffect)((()=>{const e=N(((e,t)=>{let{name:r,type:s}=t;"change"===s&&r&&b(r,e[r])}));return()=>e.unsubscribe()}),[N,b]);const V=(0,a.useMemo)((()=>[{value:p("partLubricant"),label:p("partLubricant")},{value:p("partPumpSeal"),label:p("partPumpSeal")},{value:p("partThrustChamber"),label:p("partThrustChamber")},{value:p("partVFDBreaker"),label:p("partVFDBreaker")},{value:p("partServiceKit"),label:p("partServiceKit")},{value:p("partOther"),label:p("partOther")}]),[p]),M=(0,a.useCallback)((()=>{if(!j)return;const e=N("parts")||[];w("parts",[...e,j]),y("")}),[j,N,w]),H=(0,a.useCallback)((e=>{const t=[...N("parts")||[]];t.splice(e,1),w("parts",t)}),[N,w]),{submitJobTicket:z,isSubmitting:q,submitError:B,submitSuccess:L}=(0,l.yS)(),[P,R]=(0,a.useState)(!1),[I,J]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(L){R(!0);const e=setTimeout((()=>R(!1)),5e3);return()=>clearTimeout(e)}}),[L]),(0,a.useEffect)((()=>{if(B){J(!0);const e=setTimeout((()=>J(!1)),5e3);return()=>clearTimeout(e)}}),[B]);const $=(0,d.DW)((async e=>{try{const t=g(e);await z(t)}catch(t){console.error("Error submitting job ticket:",t)}}));return(0,m.jsx)(c.lV,{onSubmit:k($),className:"space-y-6 max-w-3xl mx-auto",children:(0,m.jsxs)(c.Zp,{className:"p-6",children:[P&&(0,m.jsx)("div",{className:"mb-4 p-4 bg-green-900 bg-opacity-20 border border-green-700 rounded-md",children:(0,m.jsx)("p",{className:"text-green-400",children:p("jobTicket.submitSuccess")})}),I&&(0,m.jsx)("div",{className:"mb-4 p-4 bg-red-900 bg-opacity-20 border border-red-700 rounded-md",children:(0,m.jsx)("p",{className:"text-red-400",children:B})}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,m.jsx)(c.pd,{type:"date",id:"jobDate",name:"jobDate",label:p("jobTicket.date"),register:f,rules:{required:!0},error:T.jobDate,errorText:p("errors.required"),readOnly:x}),(0,m.jsx)(c.pd,{type:"text",id:"companyName",name:"companyName",label:p("jobTicket.companyName"),register:f,rules:{required:!0},error:T.companyName,errorText:p("errors.required"),readOnly:x}),(0,m.jsx)(c.pd,{type:"text",id:"customerName",name:"customerName",label:p("jobTicket.customerName"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"text",id:"location",name:"location",label:p("jobTicket.location"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"text",id:"workType",name:"workType",label:p("jobTicket.workType")||"Work Type",register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"text",id:"equipment",name:"equipment",label:p("jobTicket.equipment")||"Equipment Serviced",register:f,readOnly:x})]}),(0,m.jsxs)("div",{className:"mt-8",children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-200 mb-4",children:p("jobTicket.workTotalTime")}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,m.jsx)(c.pd,{type:"time",id:"workStartTime",name:"workStartTime",label:p("jobTicket.workStartTime"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"time",id:"workEndTime",name:"workEndTime",label:p("jobTicket.workEndTime"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"number",id:"workTotalHours",name:"workTotalHours",label:p("jobTicket.workTotalTime"),register:f,readOnly:!0,step:"0.01"})]})]}),(0,m.jsxs)("div",{className:"mt-8",children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-200 mb-4",children:p("jobTicket.travelTotalTime")}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,m.jsx)(c.pd,{type:"time",id:"driveStartTime",name:"driveStartTime",label:p("jobTicket.travelStartTime"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"time",id:"driveEndTime",name:"driveEndTime",label:p("jobTicket.travelEndTime"),register:f,readOnly:x}),(0,m.jsx)(c.pd,{type:"number",id:"driveTotalHours",name:"driveTotalHours",label:p("jobTicket.travelTotalTime"),register:f,readOnly:!0,step:"0.01"})]})]}),(0,m.jsxs)("div",{className:"mt-8",children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-200 mb-4",children:p("jobTicket.parts.title")}),!x&&(0,m.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,m.jsxs)("select",{className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",value:j,onChange:e=>y(e.target.value),children:[(0,m.jsx)("option",{value:"",children:p("selectPartsPlaceholder")}),V.map((e=>(0,m.jsx)("option",{value:e.value,children:e.label},e.value)))]}),(0,m.jsx)(c.$n,{type:"button",onClick:M,disabled:!j,variant:"secondary",children:p("addPart")})]}),(0,m.jsx)("div",{className:"bg-gray-800 rounded-md border border-gray-700 p-4",children:(null===(t=N("parts"))||void 0===t?void 0:t.length)>0?(0,m.jsx)("ul",{className:"divide-y divide-gray-700",children:null===(r=N("parts"))||void 0===r?void 0:r.map(((e,t)=>(0,m.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,m.jsx)("span",{children:e}),!x&&(0,m.jsx)(c.$n,{type:"button",onClick:()=>H(t),variant:"danger",size:"sm",children:p("removePart")})]},t)))}):(0,m.jsx)("p",{className:"text-gray-400",children:p("noParts","No parts added")})})]}),(0,m.jsxs)("div",{className:"mt-8",children:[(0,m.jsx)("label",{htmlFor:"workDescription",className:"block text-sm font-medium text-gray-300",children:p("jobTicket.workDescription")}),(0,m.jsx)("div",{className:"mt-1",children:(0,m.jsx)("textarea",(0,s.A)((0,s.A)({id:"workDescription",name:"workDescription",className:"bg-gray-800 block w-full rounded-md border-gray-700 text-white shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm",rows:4,placeholder:p("jobTicket.workDescription")},f("workDescription")),{},{readOnly:x}))})]}),!x&&(0,m.jsx)("div",{className:"mt-8 flex justify-end",children:(0,m.jsx)(c.$n,{type:"submit",disabled:q,className:"w-full md:w-auto",children:p(q?"submitting":"submit")})})]})})},u=a.memo(x)}}]);
//# sourceMappingURL=dashboard.d4fc2b44.chunk.js.map