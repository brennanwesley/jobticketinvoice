"use strict";(self.webpackChunkjobticketinvoice_frontend=self.webpackChunkjobticketinvoice_frontend||[]).push([[111],{911:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(5043),r=a(2136),n=a(579);const i=()=>{const{language:e,toggleLanguage:t}=(0,r.ok)(),a="en"===e?"Espa\xf1ol":"English",s="es"===e?"click for":"haga clic para";return(0,n.jsxs)("button",{onClick:t,className:"absolute top-0 right-0 m-4 px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-md transition-colors flex items-center focus:outline-none focus:ring-2 focus:ring-orange-700","aria-label":"".concat(s," ").concat(a),title:"".concat(s," ").concat(a),tabIndex:0,children:[(0,n.jsx)("span",{className:"text-xs italic text-white mr-1",children:s}),(0,n.jsx)("span",{children:a})]})},o=(0,s.memo)(i)},4592:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ae});var s=a(5043),r=a(2136),n=a(1612),i=a(2555),o=a(8729),l=a(3449),c=a(579);const d=()=>{const{user:e,isAuthenticated:t}=(0,o.As)(),a=(0,s.useMemo)((()=>t&&e&&("manager"===e.role||"admin"===e.role)),[t,e]),r=(0,s.useMemo)((()=>t&&e&&"admin"===e.role),[t,e]),n=(0,s.useMemo)((()=>t&&e&&"tech"===e.role),[t,e]),d=(0,s.useMemo)((()=>(null===e||void 0===e?void 0:e.company_id)||null),[e]),m=(0,s.useCallback)((()=>!(!t||!e)&&("manager"===e.role||"admin"===e.role)),[t,e]),u=(0,s.useCallback)((()=>m()),[m]),x=(0,s.useCallback)((()=>m()),[m]),g=(0,s.useCallback)((()=>m()),[m]),h=(0,s.useCallback)((()=>m()),[m]),p=(0,s.useCallback)((()=>m()),[m]),b=(0,s.useCallback)((()=>m()),[m]),j=(0,s.useCallback)((()=>m()),[m]),f=(0,s.useCallback)((()=>m()),[m]),v=(0,s.useCallback)((e=>!(!d||!e)&&d===e),[d]),y=(0,s.useCallback)((async function(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!1,n="";if(t)if(e){switch(a){case"manager_features":r=m(),n=r?"":"Insufficient role permissions";break;case"technician_management":r=u(),n=r?"":"Cannot manage technicians";break;case"company_profile":r=x(),n=r?"":"Cannot edit company profile";break;case"audit_logs":r=g(),n=r?"":"Cannot view audit logs";break;case"data_export":r=h(),n=r?"":"Cannot export data";break;case"invite_technicians":r=p(),n=r?"":"Cannot invite technicians";break;case"deactivate_technicians":r=b(),n=r?"":"Cannot deactivate technicians";break;case"batch_operations":r=j(),n=r?"":"Cannot perform batch operations";break;case"upload_logo":r=f(),n=r?"":"Cannot upload company logo";break;default:r=!1,n="Unknown permission type"}r&&s.targetCompanyId&&(v(s.targetCompanyId)||(r=!1,n="Cross-company access denied"))}else n="User data not available";else n="User not authenticated";return r||await(0,l.wu)(l.Km.UNAUTHORIZED_ACCESS_ATTEMPT,{permission:a,reason:n,context:s,user_id:(null===e||void 0===e?void 0:e.id)||null,user_email:(null===e||void 0===e?void 0:e.email)||null,user_role:(null===e||void 0===e?void 0:e.role)||null,company_id:d,url:window.location.pathname,timestamp:(new Date).toISOString()}),{hasAccess:r,reason:r?null:n}}),[t,e,d,m,u,x,g,h,p,b,j,f,v]),N=(0,s.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manager_features";return function(a){const{hasAccess:s}=y(t);return s?(0,c.jsx)(e,(0,i.A)({},a)):(0,c.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[(0,c.jsx)("h4",{className:"alert-heading",children:"Access Denied"}),(0,c.jsx)("p",{children:"You don't have permission to access this feature."}),(0,c.jsx)("hr",{}),(0,c.jsx)("p",{className:"mb-0",children:"Please contact your administrator if you believe this is an error."})]})}}),[y]),w=(0,s.useCallback)((()=>({isAuthenticated:t,isManager:a,isAdmin:r,isTechnician:n,companyId:d,permissions:{managerFeatures:m(),technicianManagement:u(),companyProfile:x(),auditLogs:g(),dataExport:h(),inviteTechnicians:p(),deactivateTechnicians:b(),batchOperations:j(),uploadLogo:f()}})),[t,a,r,n,d,m,u,x,g,h,p,b,j,f]);return{isManager:a,isAdmin:r,isTechnician:n,isAuthenticated:t,user:e,companyId:d,canAccessManagerFeatures:m,canManageTechnicians:u,canEditCompanyProfile:x,canViewAuditLogs:g,canExportData:h,canInviteTechnicians:p,canDeactivateTechnicians:b,canPerformBatchOperations:j,canUploadCompanyLogo:f,belongsToSameCompany:v,validateAccess:y,withManagerAccess:N,getPermissionsSummary:w}},m=e=>{let{show:t,onHide:a,onSuccess:o}=e;const{t:m}=(0,r.ok)(),{inviteTechnician:u}=(0,n.zS)(),{validateAccess:x}=d(),[g,h]=(0,s.useState)({email:"",firstName:"",lastName:"",jobType:""}),[p,b]=(0,s.useState)({}),[j,f]=(0,s.useState)(!1),v=e=>{const{name:t,value:a}=e.target;h((e=>(0,i.A)((0,i.A)({},e),{},{[t]:a}))),p[t]&&b((e=>(0,i.A)((0,i.A)({},e),{},{[t]:null})))},y=()=>{j||(h({email:"",firstName:"",lastName:"",jobType:""}),b({}),a())};return t?(0,c.jsx)("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,c.jsx)("div",{className:"modal-dialog modal-lg",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsxs)("h5",{className:"modal-title",children:[(0,c.jsx)("i",{className:"bi bi-person-plus me-2"}),m("manager.techManagement.inviteForm.title")]}),(0,c.jsx)("button",{type:"button",className:"btn-close",onClick:y,disabled:j,"aria-label":m("common.close")})]}),(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return g.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email)||(e.email=m("manager.techManagement.inviteForm.errors.emailInvalid")):e.email=m("manager.techManagement.inviteForm.errors.emailRequired"),g.firstName.trim()?g.firstName.trim().length<2&&(e.firstName=m("manager.techManagement.inviteForm.errors.firstNameTooShort")):e.firstName=m("manager.techManagement.inviteForm.errors.firstNameRequired"),g.lastName.trim()?g.lastName.trim().length<2&&(e.lastName=m("manager.techManagement.inviteForm.errors.lastNameTooShort")):e.lastName=m("manager.techManagement.inviteForm.errors.lastNameRequired"),g.jobType||(e.jobType=m("manager.techManagement.inviteForm.errors.jobTypeRequired")),b(e),0===Object.keys(e).length})())return;const{hasAccess:t}=await x("invitation_management");if(t){f(!0),b({});try{const e=await u({email:g.email.trim(),first_name:g.firstName.trim(),last_name:g.lastName.trim(),job_type:g.jobType});var a,s,r,n;if(e.success)await(0,l.Ip)(l.Km.TECHNICIAN_INVITED,null,"".concat(g.firstName," ").concat(g.lastName),{email:g.email,job_type:g.jobType,invitation_id:null===(a=e.invitation)||void 0===a?void 0:a.id}),h({email:"",firstName:"",lastName:"",jobType:""}),o();else null!==(s=e.error)&&void 0!==s&&s.includes("already exists")||null!==(r=e.error)&&void 0!==r&&r.includes("duplicate")?b({email:m("manager.techManagement.inviteForm.errors.emailExists")}):null!==(n=e.error)&&void 0!==n&&n.includes("invalid email")?b({email:m("manager.techManagement.inviteForm.errors.emailInvalid")}):b({submit:e.error||m("common.errorOccurred")})}catch(i){console.error("Error inviting technician:",i),b({submit:m("common.errorOccurred")})}finally{f(!1)}}else b({submit:m("common.accessDenied")})},children:[(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("p",{className:"text-muted mb-4",children:m("manager.techManagement.inviteForm.description")}),p.submit&&(0,c.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[(0,c.jsx)("i",{className:"bi bi-exclamation-triangle me-2"}),p.submit]}),(0,c.jsxs)("div",{className:"row g-3",children:[(0,c.jsxs)("div",{className:"col-12",children:[(0,c.jsxs)("label",{htmlFor:"email",className:"form-label",children:[m("manager.techManagement.inviteForm.email")," ",(0,c.jsx)("span",{className:"text-danger",children:"*"})]}),(0,c.jsx)("input",{type:"email",className:"form-control ".concat(p.email?"is-invalid":""),id:"email",name:"email",value:g.email,onChange:v,placeholder:m("manager.techManagement.inviteForm.emailPlaceholder"),disabled:j,autoComplete:"email"}),p.email&&(0,c.jsx)("div",{className:"invalid-feedback",children:p.email}),(0,c.jsx)("div",{className:"form-text",children:m("manager.techManagement.inviteForm.emailHelp")})]}),(0,c.jsxs)("div",{className:"col-md-6",children:[(0,c.jsxs)("label",{htmlFor:"firstName",className:"form-label",children:[m("manager.techManagement.inviteForm.firstName")," ",(0,c.jsx)("span",{className:"text-danger",children:"*"})]}),(0,c.jsx)("input",{type:"text",className:"form-control ".concat(p.firstName?"is-invalid":""),id:"firstName",name:"firstName",value:g.firstName,onChange:v,placeholder:m("manager.techManagement.inviteForm.firstNamePlaceholder"),disabled:j,autoComplete:"given-name"}),p.firstName&&(0,c.jsx)("div",{className:"invalid-feedback",children:p.firstName})]}),(0,c.jsxs)("div",{className:"col-md-6",children:[(0,c.jsxs)("label",{htmlFor:"lastName",className:"form-label",children:[m("manager.techManagement.inviteForm.lastName")," ",(0,c.jsx)("span",{className:"text-danger",children:"*"})]}),(0,c.jsx)("input",{type:"text",className:"form-control ".concat(p.lastName?"is-invalid":""),id:"lastName",name:"lastName",value:g.lastName,onChange:v,placeholder:m("manager.techManagement.inviteForm.lastNamePlaceholder"),disabled:j,autoComplete:"family-name"}),p.lastName&&(0,c.jsx)("div",{className:"invalid-feedback",children:p.lastName})]}),(0,c.jsxs)("div",{className:"col-12",children:[(0,c.jsxs)("label",{htmlFor:"jobType",className:"form-label",children:[m("manager.techManagement.inviteForm.jobType")," ",(0,c.jsx)("span",{className:"text-danger",children:"*"})]}),(0,c.jsxs)("select",{className:"form-select ".concat(p.jobType?"is-invalid":""),id:"jobType",name:"jobType",value:g.jobType,onChange:v,disabled:j,children:[(0,c.jsx)("option",{value:"",children:m("manager.techManagement.inviteForm.jobTypePlaceholder")}),["Electrician","Plumber","HVAC Technician","Carpenter","General Maintenance","Appliance Repair","Landscaper","Painter","Cleaner","Other"].map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]}),p.jobType&&(0,c.jsx)("div",{className:"invalid-feedback",children:p.jobType}),(0,c.jsx)("div",{className:"form-text",children:m("manager.techManagement.inviteForm.jobTypeHelp")})]})]}),(0,c.jsxs)("div",{className:"alert alert-info mt-4",role:"alert",children:[(0,c.jsx)("i",{className:"bi bi-info-circle me-2"}),(0,c.jsx)("strong",{children:m("manager.techManagement.inviteForm.infoTitle")}),(0,c.jsxs)("ul",{className:"mb-0 mt-2",children:[(0,c.jsx)("li",{children:m("manager.techManagement.inviteForm.info1")}),(0,c.jsx)("li",{children:m("manager.techManagement.inviteForm.info2")}),(0,c.jsx)("li",{children:m("manager.techManagement.inviteForm.info3")})]})]})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:y,disabled:j,children:m("common.cancel")}),(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),m("manager.techManagement.inviteForm.sending")]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("i",{className:"bi bi-envelope me-2"}),m("manager.techManagement.inviteForm.sendInvitation")]})})]})]})]})})}):null};var u=a(7591);const x=e=>{let{type:t="info",message:a,duration:r=5e3,show:n=!0,onClose:i}=e;const[o,l]=(0,s.useState)(n);(0,s.useEffect)((()=>{if(l(n),n&&r){const e=setTimeout((()=>{l(!1),i&&i()}),r);return()=>clearTimeout(e)}}),[n,r,i]);if(!o)return null;const d={success:"bg-green-500 bg-opacity-20 border border-green-500 text-green-500",error:"bg-red-500 bg-opacity-20 border border-red-500 text-red-500",warning:"bg-yellow-500 bg-opacity-20 border border-yellow-500 text-yellow-500",info:"bg-blue-500 bg-opacity-20 border border-blue-500 text-blue-500"};return(0,c.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 px-4 py-3 rounded-md shadow-lg flex items-center justify-between ".concat(d[t]||d.info),children:[(0,c.jsx)("div",{className:"mr-3",children:a}),(0,c.jsx)("button",{onClick:()=>{l(!1),i&&i()},className:"text-current hover:text-opacity-70","aria-label":"Close",children:(0,c.jsx)(u.A,{className:"h-5 w-5"})})]})};var g=a(7629),h=a(5590),p=a(4538),b=a(7012),j=a(8682),f=a(9850);const v=()=>{const{t:e}=(0,r.ok)(),{technicians:t,loadingTechnicians:a,technicianError:o,technicianFilter:l,setTechnicianFilter:u,selectedTechnicians:v,setSelectedTechnicians:y,fetchTechnicians:N,updateTechnicianStatus:w,batchUpdateTechnicians:k,resendInvitation:_,getTechnicianStats:T,invitations:A}=(0,n.zS)(),{validateAccess:C}=d(),[S,F]=(0,s.useState)(!1),[M,E]=(0,s.useState)(null),[I,O]=(0,s.useState)(""),[D,L]=(0,s.useState)("name"),[P,R]=(0,s.useState)("asc");(0,s.useEffect)((()=>{N()}),[N]);const q=[{id:1,name:"John Smith",email:"john.smith@example.com",phone:"(555) 123-4567",is_active:!0},{id:2,name:"Maria Garcia",email:"maria.garcia@example.com",phone:"(555) 234-5678",is_active:!0},{id:3,name:"David Johnson",email:"david.johnson@example.com",phone:"(555) 345-6789",is_active:!1}],U=t.length>0?t:q,J=(0,s.useMemo)((()=>{if(t.length>0){const e=t.filter((e=>e.is_active&&!e.force_password_reset)),a=A.length;return{total:t.length,active:e.length,pending:a}}{const e=q.filter((e=>e.is_active));return{total:q.length,active:e.length,pending:2}}}),[t,A]),H=(0,s.useCallback)((()=>{let e=U.filter((e=>{var t,a,s,r;return!I||(null===(t=e.first_name)||void 0===t?void 0:t.toLowerCase().includes(I.toLowerCase()))||(null===(a=e.last_name)||void 0===a?void 0:a.toLowerCase().includes(I.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(I.toLowerCase()))||(null===(r=e.job_type)||void 0===r?void 0:r.toLowerCase().includes(I.toLowerCase()))}));return e.sort(((e,t)=>{let a,s;switch(D){case"name":a="".concat(e.first_name||""," ").concat(e.last_name||"").trim(),s="".concat(t.first_name||""," ").concat(t.last_name||"").trim();break;case"email":a=e.email||"",s=t.email||"";break;case"status":a=B(e),s=B(t);break;case"jobType":a=e.job_type||"",s=t.job_type||"";break;case"lastActive":a=new Date(e.last_login||0),s=new Date(t.last_login||0);break;default:a=e[D]||"",s=t[D]||""}if("lastActive"===D)return"asc"===P?a-s:s-a;const r=a.toString().localeCompare(s.toString());return"asc"===P?r:-r})),e}),[U,I,D,P]),B=e=>e.is_active?1:e.force_password_reset?2:3,V=t=>t.is_active?{key:"active",label:e("techManagement.statusActive"),color:"text-green-400"}:t.force_password_reset?{key:"pending",label:e("techManagement.statusPending"),color:"text-yellow-400"}:{key:"deactivated",label:e("techManagement.statusDeactivated"),color:"text-gray-400"},z=H();return(0,c.jsxs)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-6",children:[(0,c.jsx)("div",{className:"mb-6",children:(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:e("manager.techManagement.title")}),(0,c.jsx)("p",{className:"text-gray-400",children:e("manager.techManagement.subtitle")})]}),(0,c.jsxs)("button",{onClick:async()=>{const{hasAccess:t}=await C("invite_technician");t?F(!0):E({type:"error",message:e("common.accessDenied")})},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 font-medium",children:[(0,c.jsx)(g.A,{className:"h-5 w-5"}),e("manager.techManagement.inviteTechnician")]})]})}),(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:e("manager.techManagement.statBoxes.title")}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(h.A,{className:"h-8 w-8 text-blue-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:a?"...":J.total}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.techManagement.statBoxes.totalTechnicians")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(p.A,{className:"h-8 w-8 text-green-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:a?"...":J.active}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.techManagement.statBoxes.activeTechnicians")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(b.A,{className:"h-8 w-8 text-yellow-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:a?"...":J.pending}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.techManagement.statBoxes.pendingInvitations")})]})]})})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:e("manager.techManagement.table.title")}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-lg overflow-hidden",children:a?(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),(0,c.jsx)("p",{className:"mt-4 text-gray-400",children:e("common.loading")})]}):o?(0,c.jsx)("div",{className:"p-8 text-center",children:(0,c.jsx)("p",{className:"text-red-400",children:o})}):0===z.length?(0,c.jsxs)("div",{className:"p-8 text-center",children:[(0,c.jsx)(h.A,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),(0,c.jsx)("p",{className:"text-gray-400 mb-2",children:e("manager.techManagement.table.noTechnicians")}),(0,c.jsx)("p",{className:"text-gray-500 text-sm",children:e("manager.techManagement.table.inviteFirstTechnician")})]}):(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"w-full",children:[(0,c.jsx)("thead",{className:"bg-gray-700",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.techManagement.table.headers.name")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.techManagement.table.headers.email")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider hidden sm:table-cell",children:e("manager.techManagement.table.headers.phoneNumber")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.techManagement.table.headers.status")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.techManagement.table.headers.actions")})]})}),(0,c.jsx)("tbody",{className:"divide-y divide-gray-700",children:z.map(((a,s)=>(0,c.jsxs)("tr",{className:"hover:bg-gray-750 transition-colors duration-150",children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsx)("div",{className:"text-sm font-medium text-white",children:a.name||"".concat(a.first_name||""," ").concat(a.last_name||"").trim()})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsxs)("div",{className:"flex items-center text-sm text-gray-300",children:[(0,c.jsx)(j.A,{className:"h-4 w-4 mr-2 text-gray-500"}),a.email]})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap hidden sm:table-cell",children:(0,c.jsxs)("div",{className:"flex items-center text-sm text-gray-300",children:[(0,c.jsx)(f.A,{className:"h-4 w-4 mr-2 text-gray-500"}),a.phone||"Not provided"]})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsxs)("div",{className:"flex items-center",children:["active"===V(a).key?(0,c.jsx)(p.A,{className:"h-4 w-4 text-green-500 mr-2"}):"pending"===V(a).key?(0,c.jsx)(b.A,{className:"h-4 w-4 text-yellow-500 mr-2"}):(0,c.jsx)("div",{className:"h-4 w-4 mr-2 bg-gray-500 rounded-full"}),(0,c.jsx)("span",{className:"text-sm font-medium ".concat(V(a).color),children:V(a).label})]})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsx)("div",{className:"flex items-center",children:"active"===V(a).key?(0,c.jsx)("button",{className:"text-sm text-red-500 hover:text-red-700 transition-colors duration-200",onClick:()=>(async a=>{try{console.log("Deactivating technician:",a),U.map((e=>e.id===a?(0,i.A)((0,i.A)({},e),{},{is_active:!1}):e)),t.length,E((t=>(0,i.A)((0,i.A)({},t),{},{type:"success",message:e("techManagement.messages.technicianDeactivated")})))}catch(s){console.error("Error deactivating technician:",s),E((e=>(0,i.A)((0,i.A)({},e),{},{type:"error",message:"Error deactivating technician"})))}})(a.id),children:e("manager.techManagement.table.actions.deactivate")}):(0,c.jsx)("button",{className:"text-sm text-red-500 hover:text-red-700 transition-colors duration-200",onClick:()=>(async(a,s)=>{if(window.confirm(e("techManagement.confirmations.delete.message",{name:s})))try{console.log("Deleting technician:",a),U.filter((e=>e.id!==a)),t.length,E((t=>(0,i.A)((0,i.A)({},t),{},{type:"success",message:e("techManagement.messages.technicianDeleted")})))}catch(r){console.error("Error deleting technician:",r),E((e=>(0,i.A)((0,i.A)({},e),{},{type:"error",message:"Error deleting technician"})))}})(a.id,a.name),children:e("manager.techManagement.table.actions.delete")})})})]},a.id||s)))})]})})})]}),S&&(0,c.jsx)(m,{isOpen:S,onClose:()=>F(!1),onSuccess:a=>{if(F(!1),a&&a.id){E({type:"success",message:e("manager.techManagement.messages.technicianCreated",{name:a.name})});a.id,a.name,a.email,a.phone,(new Date).toISOString();t&&t.length>0&&N()}else E({type:"success",message:e("manager.techManagement.messages.invitationSent")});N()}}),M&&(0,c.jsx)(x,{type:M.type,message:M.message,onClose:()=>E(null)})]})},y=()=>{const{t:e}=(0,r.ok)(),{user:t}=(0,o.As)(),{companyProfile:a,loadingCompany:i,companyError:l,fetchCompanyProfile:m}=(0,n.zS)(),{validateAccess:u}=d(),[g,h]=(0,s.useState)(null);(0,s.useEffect)((()=>{console.log("CompanyProfile: Component mounted, fetching company profile..."),m()}),[m]),(0,s.useEffect)((()=>{u()||h({type:"error",message:e("common.insufficientPermissions"),duration:5e3})}),[u,e]);return i?(0,c.jsx)("div",{className:"company-profile-container",children:(0,c.jsx)("div",{className:"loading-spinner",children:(0,c.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,c.jsx)("span",{className:"visually-hidden",children:e("common.loading")})})})}):l?(0,c.jsx)("div",{className:"company-profile-container",children:(0,c.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[(0,c.jsx)("h4",{className:"alert-heading",children:e("common.error")}),(0,c.jsx)("p",{children:l}),(0,c.jsx)("button",{className:"btn btn-outline-danger",onClick:m,children:e("common.retry")})]})}):(0,c.jsxs)("div",{className:"company-profile-container",children:[g&&(0,c.jsx)(x,{type:g.type,message:g.message,duration:g.duration,onClose:()=>h(null)}),(0,c.jsxs)("div",{className:"card shadow-sm border mb-4",children:[(0,c.jsx)("div",{className:"card-header bg-primary text-white",children:(0,c.jsxs)("h3",{className:"card-title mb-0",children:[(0,c.jsx)("i",{className:"fas fa-building me-2"}),e("manager.companyProfile.title")]})}),(0,c.jsxs)("div",{className:"card-body",children:[(0,c.jsxs)("div",{className:"row",children:[(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsxs)("strong",{children:[e("manager.companyProfile.companyName"),":"]}),(0,c.jsx)("span",{className:"ms-2",children:(null===a||void 0===a?void 0:a.name)||e("common.notAvailable")})]})}),(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsxs)("strong",{children:[e("manager.companyProfile.managerName"),":"]}),(0,c.jsx)("span",{className:"ms-2",children:null!==t&&void 0!==t&&t.first_name&&null!==t&&void 0!==t&&t.last_name?"".concat(t.first_name," ").concat(t.last_name):(null===t||void 0===t?void 0:t.email)||e("common.notAvailable")})]})})]}),(0,c.jsxs)("div",{className:"row",children:[(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsxs)("strong",{children:[e("manager.companyProfile.technicianCount"),":"]}),(0,c.jsx)("span",{className:"ms-2",children:"0"})]})}),(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsxs)("strong",{children:[e("manager.companyProfile.rateSheet"),":"]}),(0,c.jsxs)("div",{className:"ms-2 d-inline-block",children:[(0,c.jsxs)("button",{className:"btn btn-outline-primary btn-sm me-2",disabled:!0,children:[(0,c.jsx)("i",{className:"fas fa-upload me-1"}),e("manager.companyProfile.uploadRateSheet")]}),(0,c.jsx)("small",{className:"text-muted",children:e("manager.companyProfile.rateSheetNote")})]})]})})]})]})]}),(0,c.jsxs)("div",{className:"card shadow-sm border",children:[(0,c.jsx)("div",{className:"card-header bg-secondary text-white",children:(0,c.jsxs)("h3",{className:"card-title mb-0",children:[(0,c.jsx)("i",{className:"fas fa-cog me-2"}),e("manager.settings.title")]})}),(0,c.jsx)("div",{className:"card-body",children:(0,c.jsxs)("div",{className:"text-center py-4",children:[(0,c.jsx)("i",{className:"fas fa-tools fa-3x text-muted mb-3"}),(0,c.jsx)("p",{className:"text-muted mb-0",children:e("manager.settings.comingSoon")})]})})]})]})};var N=a(8084),w=a(7488),k=a(2704),_=a(2811),T=a(7438),A=a(9399),C=a(1425),S=a(1559),F=a(7988),M=a(8662),E=a(2683),I=a(9248);const O=e=>{let{isOpen:t,onClose:a,onInvoiceCreated:n,selectedJobTickets:l=[],mode:d="manual"}=e;const{t:m}=(0,r.ok)(),{user:x}=(0,o.As)(),[g,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)({invoice_number:"",invoice_date:(new Date).toISOString().split("T")[0],company_name:"",customer_name:"",line_items:[],notes:""});(0,s.useEffect)((()=>{if(t){const e=(()=>{const e=(new Date).getFullYear().toString().slice(-2),t=Math.floor(1e6*Math.random()).toString().padStart(6,"0");return"".concat(e).concat(t)})();b((t=>(0,i.A)((0,i.A)({},t),{},{invoice_number:e,invoice_date:(new Date).toISOString().split("T")[0],company_name:"jobTickets"===d&&l.length>0&&l[0].company_name||"",line_items:"jobTickets"===d?f():[],customer_name:"jobTickets"===d&&l.length>0&&l[0].customer_name||""})))}}),[t]),(0,s.useEffect)((()=>{if(t&&"jobTickets"===d&&l.length>0)try{console.log("Processing job tickets for invoice:",l);const e=f();console.log("Generated line items:",e);const t=l[0].customer_name||"",a=l[0].company_name||"";b((s=>(0,i.A)((0,i.A)({},s),{},{line_items:e,customer_name:t,company_name:a})))}catch(e){console.error("Error processing job tickets for invoice:",e),w.oR.error("Error processing job tickets. Please try again."),b((e=>(0,i.A)((0,i.A)({},e),{},{line_items:[],customer_name:"",company_name:""})))}}),[t,d,l]);const f=()=>{if(!l||0===l.length)return[];const e=[...new Set(l.map((e=>e.company_name)).filter(Boolean))];return e.length>1?(console.error("Job tickets from multiple customer companies:",e),w.oR.error("Cannot create invoice: Job tickets are from different customer companies (".concat(e.join(", "),"). Please select tickets from the same customer.")),[]):0===e.length?(console.error("No customer company found in selected job tickets"),w.oR.error("Cannot create invoice: Selected job tickets do not have customer company information."),[]):l.map(((e,t)=>{try{const t=parseFloat(e.rate)||100,a=parseFloat(e.total_work_hours)||0,s=a+.5*(parseFloat(e.total_travel_hours)||0),r=t*s;return{id:"jt_".concat(e.id),job_ticket_id:e.id,description:"Job Ticket #".concat(e.id," - ").concat(e.description||"Service Work"),rate:t,quantity:s,cost:r,total:r}}catch(a){return console.error("Error processing job ticket ".concat(e.id,":"),a,e),{id:"jt_".concat(e.id,"_error"),job_ticket_id:e.id,description:"Job Ticket #".concat(e.id," - Error processing data"),rate:0,quantity:0,cost:0,total:0}}}))},v=(0,s.useMemo)((()=>{const e=p.line_items.reduce(((e,t)=>e+(parseFloat(t.rate)||0)*(parseFloat(t.quantity)||0)),0),t=.49*p.line_items.filter((e=>e.job_ticket_id)).length+.99,a=e+t+0;return{subtotal:(e||0).toFixed(2),serviceFee:(t||0).toFixed(2),tax:(0).toFixed(2),total:(a||0).toFixed(2)}}),[p.line_items]),y=(e,t,a)=>{const s="rate"===t||"quantity"===t?parseFloat(a)||0:a;b((a=>(0,i.A)((0,i.A)({},a),{},{line_items:a.line_items.map(((a,r)=>{if(r===e){const e=(0,i.A)((0,i.A)({},a),{},{[t]:s});if("rate"===t||"quantity"===t){const t=(parseFloat(e.rate)||0)*(parseFloat(e.quantity)||0);e.cost=t,e.total=t}return e}return a}))})))},N=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Draft";const t=(()=>{var e,t;const a=[];null!==(e=p.invoice_number)&&void 0!==e&&e.trim()||a.push("Invoice number is required"),null!==(t=p.company_name)&&void 0!==t&&t.trim()||a.push("Customer company name is required"),p.line_items&&0!==p.line_items.length||a.push("At least one line item is required"),p.line_items.forEach(((e,t)=>{var s;null!==(s=e.description)&&void 0!==s&&s.trim()||a.push("Line item ".concat(t+1,": Description is required")),(!e.rate||e.rate<=0)&&a.push("Line item ".concat(t+1,": Rate must be greater than 0")),(!e.quantity||e.quantity<=0)&&a.push("Line item ".concat(t+1,": Quantity must be greater than 0"))}));const s=parseFloat(v.total);return(isNaN(s)||s<=0)&&a.push("Invoice total must be greater than 0"),a})();if(t.length>0)w.oR.error("Please fix the following errors:\n".concat(t.join("\n")));else{h(!0);try{const t={invoice_number:p.invoice_number,invoice_date:new Date(p.invoice_date).toISOString(),customer_name:p.customer_name,company_name:p.company_name,subtotal:parseFloat(v.subtotal),service_fee:parseFloat(v.serviceFee),tax:parseFloat(v.tax),total_amount:parseFloat(v.total),line_items:p.line_items.map((e=>({description:e.description,rate:parseFloat(e.rate),quantity:parseFloat(e.quantity),amount:parseFloat(e.cost||e.total||0)}))),job_ticket_ids:p.line_items.filter((e=>e.job_ticket_id)).map((e=>e.job_ticket_id)),status:e,created_by:(null===x||void 0===x?void 0:x.name)||"Unknown User",notes:p.notes||""};console.log("Submitting invoice payload:",t);const s=await fetch("/api/v1/invoices",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(t)});if(!s.ok){const e=await s.json().catch((()=>({})));throw new Error(e.detail||"Failed to save invoice")}const r=await s.json();console.log("Invoice created successfully:",r),w.oR.success("Invoice ".concat(e.toLowerCase()," successfully!")),a(),"function"===typeof n&&n(r)}catch(s){console.error("Error creating invoice:",s),w.oR.error("Failed to create invoice: ".concat(s.message))}finally{h(!1)}}},[_,A]=(0,s.useState)(!1),[O,D]=(0,s.useState)(!1),L=()=>{A(!1)};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(C.A,{isOpen:t,onClose:a,title:"Create Invoice",size:"2xl",footer:(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:justify-end",children:[(0,c.jsx)("button",{type:"button",onClick:a,disabled:g,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 hover:text-white focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Cancel"}),(0,c.jsx)("button",{type:"button",onClick:async()=>{await N("Draft")},disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-yellow-600 border border-transparent rounded-lg hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center",children:g?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})}),(0,c.jsx)("button",{type:"button",onClick:async()=>{await N("Submitted"),A(!0)},disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center",children:g?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T.A,{className:"h-4 w-4 mr-2"}),"Submit Invoice"]})})]}),children:(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-gray-700 rounded-lg",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"invoice_number",className:"block text-sm font-medium text-gray-300 mb-2",children:"Invoice Number *"}),(0,c.jsx)("input",{id:"invoice_number",type:"text",value:p.invoice_number,onChange:e=>b((t=>(0,i.A)((0,i.A)({},t),{},{invoice_number:e.target.value}))),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"24000001"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"invoice_date",className:"block text-sm font-medium text-gray-300 mb-2",children:"Invoice Date *"}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{id:"invoice_date",type:"date",value:p.invoice_date,onChange:e=>b((t=>(0,i.A)((0,i.A)({},t),{},{invoice_date:e.target.value}))),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,c.jsx)(F.A,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400 pointer-events-none"})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"company_name",className:"block text-sm font-medium text-gray-300 mb-2",children:"Customer Company Name *"}),(0,c.jsx)("input",{id:"company_name",type:"text",value:p.company_name,onChange:e=>b((t=>(0,i.A)((0,i.A)({},t),{},{company_name:e.target.value}))),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Customer company name",disabled:"jobTickets"===d&&l.length>0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"customer_name",className:"block text-sm font-medium text-gray-300 mb-2",children:"Customer Contact Name"}),(0,c.jsx)("input",{id:"customer_name",type:"text",value:p.customer_name,onChange:e=>b((t=>(0,i.A)((0,i.A)({},t),{},{customer_name:e.target.value}))),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Customer contact name",disabled:"jobTickets"===d&&l.length>0})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-white",children:"Line Items"}),(0,c.jsxs)("button",{type:"button",onClick:()=>{const e={id:"manual_".concat(Date.now()),description:"",rate:100,quantity:1,cost:100,total:100};b((t=>(0,i.A)((0,i.A)({},t),{},{line_items:[...t.line_items,e]})))},className:"flex items-center px-3 py-2 text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors",children:[(0,c.jsx)(M.A,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"w-full",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-600",children:[(0,c.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:"Description"}),(0,c.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:"Rate"}),(0,c.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:"Quantity"}),(0,c.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-300",children:"Cost"}),(0,c.jsx)("th",{className:"w-10"})]})}),(0,c.jsx)("tbody",{children:p.line_items.filter((e=>e&&"object"===typeof e)).map(((e,t)=>{var a,s,r,n;const o=(0,i.A)({description:e.description||"",rate:parseFloat(e.rate)||0,quantity:parseFloat(e.quantity)||0,cost:null!==(a=null!==(s=e.cost)&&void 0!==s?s:e.total)&&void 0!==a?a:0},e);return(0,c.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,c.jsx)("td",{className:"py-3 px-4",children:(0,c.jsx)("input",{type:"text",value:o.description,onChange:e=>y(t,"description",e.target.value),className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Service description"})}),(0,c.jsx)("td",{className:"py-3 px-4",children:(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(E.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,c.jsx)("input",{type:"number",value:o.rate,onChange:e=>y(t,"rate",e.target.value),className:"w-full pl-8 pr-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0.00",step:"0.01",min:"0"})]})}),(0,c.jsx)("td",{className:"py-3 px-4",children:(0,c.jsx)("input",{type:"number",value:o.quantity,onChange:e=>y(t,"quantity",e.target.value),className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"1",step:"0.01",min:"0"})}),(0,c.jsx)("td",{className:"py-3 px-4",children:(0,c.jsxs)("div",{className:"flex items-center text-white font-medium",children:["$",((null!==(r=null!==(n=o.cost)&&void 0!==n?n:o.total)&&void 0!==r?r:0)||0).toFixed(2)]})}),(0,c.jsx)("td",{className:"py-3 px-4",children:(0,c.jsx)("button",{type:"button",onClick:()=>(e=>{b((t=>(0,i.A)((0,i.A)({},t),{},{line_items:t.line_items.filter(((t,a)=>a!==e))})))})(t),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,c.jsx)(I.A,{className:"h-4 w-4"})})})]},e.id||t)}))})]})})]}),(0,c.jsx)("div",{className:"bg-gray-700 rounded-lg p-6",children:(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("div",{className:"flex justify-between text-gray-300",children:[(0,c.jsx)("span",{children:"Subtotal:"}),(0,c.jsxs)("span",{children:["$",v.subtotal]})]}),(0,c.jsxs)("div",{className:"flex justify-between text-gray-300",children:[(0,c.jsx)("span",{children:"Service Fee:"}),(0,c.jsxs)("span",{children:["$",v.serviceFee]})]}),(0,c.jsxs)("div",{className:"flex justify-between text-gray-300",children:[(0,c.jsx)("span",{children:"Tax:"}),(0,c.jsxs)("span",{children:["$",v.tax]})]}),(0,c.jsx)("div",{className:"border-t border-gray-600 pt-3",children:(0,c.jsxs)("div",{className:"flex justify-between text-white font-semibold text-lg",children:[(0,c.jsx)("span",{children:"Total:"}),(0,c.jsxs)("span",{children:["$",v.total]})]})})]})})]})}),(0,c.jsx)(C.A,{isOpen:_,onClose:L,size:"md",children:(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Delivery Options"}),(0,c.jsx)("button",{onClick:L,className:"text-gray-400 hover:text-white transition-colors",children:(0,c.jsx)(u.A,{className:"h-6 w-6"})})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("p",{className:"text-gray-300 mb-6",children:"Choose a delivery method for your invoice."}),(0,c.jsxs)("button",{onClick:async()=>{D(!0);try{await new Promise((e=>setTimeout(e,1500))),w.oR.info("Email delivery feature coming soon!")}catch(e){w.oR.error("Failed to send email")}finally{D(!1)}},disabled:O,className:"w-full flex items-center justify-between p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)(j.A,{className:"h-6 w-6 text-blue-400"}),(0,c.jsxs)("div",{className:"text-left",children:[(0,c.jsx)("div",{className:"text-white font-medium",children:"Send Email"}),(0,c.jsx)("div",{className:"text-gray-400 text-sm",children:"Send the invoice to the customer via email."})]})]}),O&&(0,c.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-400"})]}),(0,c.jsxs)("button",{onClick:async()=>{D(!0);try{await new Promise((e=>setTimeout(e,1500))),w.oR.info("QuickBooks integration coming soon!")}catch(e){w.oR.error("Failed to send to QuickBooks")}finally{D(!1)}},disabled:O,className:"w-full flex items-center justify-between p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)(k.A,{className:"h-6 w-6 text-green-400"}),(0,c.jsxs)("div",{className:"text-left",children:[(0,c.jsx)("div",{className:"text-white font-medium",children:"Send to QuickBooks"}),(0,c.jsx)("div",{className:"text-gray-400 text-sm",children:"Send the invoice to QuickBooks for further processing."})]})]}),O&&(0,c.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-400"})]}),(0,c.jsx)("button",{onClick:()=>{w.oR.success("Invoice saved as draft"),A(!1)},disabled:O,className:"w-full flex items-center justify-between p-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50",children:(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,c.jsx)(S.A,{className:"h-6 w-6 text-yellow-400"}),(0,c.jsxs)("div",{className:"text-left",children:[(0,c.jsx)("div",{className:"text-white font-medium",children:"Save as Draft"}),(0,c.jsx)("div",{className:"text-gray-400 text-sm",children:"Save the invoice as a draft for later use."})]})]})})]}),(0,c.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-700",children:(0,c.jsx)("button",{onClick:L,className:"w-full px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Close"})})]})})]})},D=e=>{let{triggerInvoiceModal:t=!1,setTriggerInvoiceModal:a}=e;const{t:n}=(0,r.ok)(),{validateAccess:i}=d(),[o,l]=(0,s.useState)([]),[m,u]=(0,s.useState)(!0),[x,g]=(0,s.useState)(null),[h,p]=(0,s.useState)(!1),b=(0,s.useCallback)((async()=>{try{u(!0),g(null),setTimeout((()=>{l([{id:1,invoice_number:"INV-00000001",created_on:"2025-06-15",created_by:"John Manager",customer_name:"ABC Corporation",total_amount:1250,status:"submitted"},{id:2,invoice_number:"INV-00000002",created_on:"2025-06-14",created_by:"John Manager",customer_name:"XYZ Industries",total_amount:875.5,status:"draft"},{id:3,invoice_number:"INV-00000003",created_on:"2025-06-13",created_by:"John Manager",customer_name:"Tech Solutions LLC",total_amount:2100.75,status:"submitted"}]),u(!1)}),1e3)}catch(e){console.error("Error fetching invoices:",e),g(e.message),u(!1),w.oR.error(n("manager.invoices.messages.errorLoading"))}}),[n]);if((0,s.useEffect)((()=>{b()}),[b]),(0,s.useEffect)((()=>{t&&(p(!0),a(!1))}),[t,a]),!i())return null;const j={totalInvoices:o.length,draftInvoices:o.filter((e=>"draft"===e.status)).length,submittedInvoices:o.filter((e=>"submitted"===e.status)).length};return m?(0,c.jsx)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-6",children:(0,c.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),(0,c.jsx)("span",{className:"ml-3 text-gray-400",children:n("common.loading")})]})}):(0,c.jsxs)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-6",children:[(0,c.jsxs)("div",{className:"mb-8 flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:n("manager.invoices.title")}),(0,c.jsx)("p",{className:"text-gray-400",children:n("manager.invoices.subtitle")})]}),(0,c.jsx)("div",{className:"lg:flex-shrink-0",children:(0,c.jsx)("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-green-600 hover:bg-green-700 focus:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-900",children:n("manager.invoices.actions.createInvoice")})})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(k.A,{className:"h-8 w-8 text-blue-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:j.totalInvoices}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:n("manager.invoices.stats.totalInvoices")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(_.A,{className:"h-8 w-8 text-gray-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:j.draftInvoices}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:n("manager.invoices.stats.draftInvoices")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(T.A,{className:"h-8 w-8 text-green-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:j.submittedInvoices}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:n("manager.invoices.stats.submittedInvoices")})]})]})})]}),(0,c.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-lg",children:[(0,c.jsx)("div",{className:"px-6 py-4 border-b border-gray-700",children:(0,c.jsx)("h2",{className:"text-lg font-semibold text-white",children:n("manager.invoices.table.title")})}),x?(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,c.jsx)(A.A,{className:"h-12 w-12 text-red-500 mb-4"}),(0,c.jsx)("p",{className:"text-red-400 mb-4",children:n("manager.invoices.messages.errorLoading")}),(0,c.jsx)("button",{onClick:b,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:n("common.retry")})]}):0===o.length?(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,c.jsx)(k.A,{className:"h-12 w-12 text-gray-500 mb-4"}),(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:n("manager.invoices.empty.title")}),(0,c.jsx)("p",{className:"text-gray-400 text-center max-w-md",children:n("manager.invoices.empty.description")})]}):(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,c.jsx)("thead",{className:"bg-gray-750",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.invoiceNumber")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.createdOn")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.createdBy")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.customerName")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.totalAmount")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.status")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:n("manager.invoices.table.headers.actions")})]})}),(0,c.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:o.map((e=>{return(0,c.jsxs)("tr",{className:"hover:bg-gray-750 transition-colors duration-150",children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:e.invoice_number}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(a=e.created_on,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:e.created_by}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:e.customer_name}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(t=e.total_amount,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t))}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("submitted"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:n("manager.invoices.table.status.".concat(e.status))})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,c.jsx)("button",{onClick:()=>{return t=e.id,console.log("Edit invoice clicked - functionality to be implemented",t),void w.oR.info("Edit functionality will be implemented in future updates");var t},className:"text-blue-400 hover:text-blue-300 transition-colors duration-200",title:n("manager.invoices.actions.edit"),children:(0,c.jsx)(_.A,{className:"h-4 w-4"})})})]},e.id);var t,a}))})]})})]}),h&&(0,c.jsx)(O,{isOpen:h,onClose:()=>p(!1),onInvoiceCreated:e=>{l((t=>[{id:e.id,invoice_number:e.invoice_number,created_on:e.created_on,created_by:e.created_by,customer_name:e.customer_name,total_amount:e.total,status:e.status},...t])),p(!1)},mode:"manual"})]})},L=e=>{if(!e||0===e.length)return{isValid:!1,error:"NO_TICKETS",message:"No job tickets selected",customerCompanies:[]};const t=[...new Set(e.map((e=>e.company_name)).filter((e=>e&&e.trim())))];return 0===t.length?{isValid:!1,error:"NO_CUSTOMER_INFO",message:"Selected job tickets do not have customer company information",customerCompanies:[]}:t.length>1?{isValid:!1,error:"MULTIPLE_CUSTOMERS",message:"Job tickets are from different customer companies: ".concat(t.join(", ")),customerCompanies:t}:{isValid:!0,error:null,message:"All job tickets are from the same customer company",customerCompanies:t,customerCompany:t[0]}},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"NO_TICKETS":return"Please select at least one job ticket to create an invoice.";case"NO_CUSTOMER_INFO":return"The selected job tickets do not have customer company information. Please check the ticket details.";case"MULTIPLE_CUSTOMERS":return"You can only create an invoice using job tickets from the same customer. The selected tickets are from different companies: ".concat(t.join(", "),". Please revise your selection.");default:return"Unable to validate job tickets for invoice creation. Please try again."}};var R=a(1369),q=a(9422),U=a(9531),J=a(4858);const H=e=>{let{isOpen:t,onClose:a,onJobTicketCreated:l}=e;const{user:d}=(0,o.As)(),{companyProfile:m}=(0,n.zS)(),{t:u}=(0,r.ok)(),[x,g]=(0,s.useState)(!1),{register:h,handleSubmit:p,reset:b,setValue:j,watch:f,formState:{errors:v}}=(0,J.mN)({defaultValues:{job_type:"generic",company_name:"",customer_name:"",location:"",description:"",work_start_time:"08:00",work_end_time:"17:00",drive_start_time:"07:00",drive_end_time:"18:00",total_work_hours:0,total_travel_hours:0,parts:[]}}),y=f("work_start_time"),k=f("work_end_time"),_=f("drive_start_time"),T=f("drive_end_time");(0,s.useEffect)((()=>{if(y&&k){const e=new Date("1970-01-01T".concat(y)),t=new Date("1970-01-01T".concat(k));if(t>e){const a=(t-e)/36e5;j("total_work_hours",Math.round(100*a)/100)}}}),[y,k,j]),(0,s.useEffect)((()=>{if(_&&T){const e=new Date("1970-01-01T".concat(_)),t=new Date("1970-01-01T".concat(T));if(t>e){const a=(t-e)/36e5;j("total_travel_hours",Math.round(100*a)/100)}}}),[_,T,j]);const A=()=>{x||(b(),a())};return(0,c.jsx)(C.A,{isOpen:t,onClose:A,title:u("manager.jobTickets.createModal.title"),size:"xl",closeOnEsc:!x,closeOnOutsideClick:!x,children:(0,c.jsxs)("form",{onSubmit:p((async e=>{g(!0);const t=(new Date).toISOString();console.log("\n"+"=".repeat(80)),console.log("\ud83d\ude80 FRONTEND JOB TICKET CREATION - TIMESTAMP: ".concat(t)),console.log("=".repeat(80)),console.log("\ud83d\udcdd RAW FORM DATA:"),Object.entries(e).forEach((e=>{let[t,a]=e;console.log("   - ".concat(t,": ").concat(JSON.stringify(a)," (type: ").concat(typeof a,")"))})),console.log("\n\ud83d\udc64 USER CONTEXT:"),console.log("   - Email: ".concat(null===d||void 0===d?void 0:d.email)),console.log("   - Name: ".concat(null===d||void 0===d?void 0:d.name)),console.log("   - First Name: ".concat(null===d||void 0===d?void 0:d.first_name)),console.log("   - Last Name: ".concat(null===d||void 0===d?void 0:d.last_name)),console.log("   - Company Profile: ".concat(JSON.stringify(m)));try{var s,r,n,i,o;const t=(new Date).getFullYear().toString().slice(-2),m=Math.floor(1e6*Math.random()).toString().padStart(6,"0"),g="".concat(t).concat(m);console.log("\n\ud83c\udfab Generated job ticket number: ".concat(g));const h={job_number:g,company_name:null===(s=e.company_name)||void 0===s?void 0:s.trim(),customer_name:(null===(r=e.customer_name)||void 0===r?void 0:r.trim())||"",location:(null===(n=e.location)||void 0===n?void 0:n.trim())||"",work_description:(null===(i=e.description)||void 0===i?void 0:i.trim())||"",work_start_time:e.work_start_time,work_end_time:e.work_end_time,work_total_hours:parseFloat(e.total_work_hours)||0,drive_start_time:e.drive_start_time,drive_end_time:e.drive_end_time,drive_total_hours:parseFloat(e.total_travel_hours)||0,submitted_by:d.name||"".concat(d.first_name," ").concat(d.last_name)||"Manager",status:"submitted",work_type:"generic",equipment:"",travel_type:"roundTrip",parts_used:JSON.stringify([]),additional_notes:(null===(o=e.additional_notes)||void 0===o?void 0:o.trim())||""};console.log("\n\ud83d\udce6 PREPARED PAYLOAD FOR BACKEND:"),Object.entries(h).forEach((e=>{let[t,a]=e;console.log("   - ".concat(t,": ").concat(JSON.stringify(a)," (type: ").concat(typeof a,")"))}));const p=["company_name","submitted_by"],j=p.filter((e=>!h[e]));if(console.log("\n\ud83d\udd0d PAYLOAD VALIDATION:"),p.forEach((e=>{const t=h[e]&&h[e].toString().trim();console.log("   ".concat(t?"\u2705":"\u274c"," ").concat(e,": ").concat(JSON.stringify(h[e])))})),j.length>0)throw console.error("\u274c Missing required fields: ".concat(j)),new Error("Missing required fields: ".concat(j.join(", ")));console.log("\u2705 All required fields present"),console.log("\n\ud83c\udf10 MAKING API CALL:"),console.log("   - URL: /job-tickets/"),console.log("   - Method: POST"),console.log("   - Headers: Content-Type: application/json"),console.log("   - Body: ".concat(JSON.stringify(h,null,2)));const f=await(0,N.Ud)("/job-tickets/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(console.log("\n\ud83d\udce1 API RESPONSE:"),console.log("   - Status: ".concat(f.status)),console.log("   - Status Text: ".concat(f.statusText)),console.log("   - OK: ".concat(f.ok)),f.headers){console.log("   - Headers:");try{for(const[e,t]of f.headers.entries())console.log("     ".concat(e,": ").concat(t))}catch(c){console.log("     Headers not available (CORS error)")}}if(console.log("\ud83d\udce1 Raw response received:",{ok:f.ok,status:f.status,statusText:f.statusText,headers:f.headers?Object.fromEntries(f.headers.entries()):"Headers not available (CORS error)"}),!f.ok){let e;console.log("\u274c Response not OK, parsing error..."),console.log("\ud83d\udcca Response status:",f.status),console.log("\ud83d\udccb Response status text:",f.statusText);let t="";try{const a=f.clone();t=await a.text(),console.log("\ud83d\udcc4 Raw response text:",t),e=JSON.parse(t),console.log("\ud83d\udccb Parsed error data:",e),422===f.status&&(console.log("\ud83d\udeab VALIDATION ERROR (422) - Backend rejected payload:"),console.log("Validation details:",e),e.detail&&console.log("Field validation errors:",e.detail))}catch(x){console.log("\u26a0\ufe0f Failed to parse response as JSON:",x),e={message:t||"HTTP ".concat(f.status,": ").concat(f.statusText),status:f.status,statusText:f.statusText}}console.log("\ud83d\udca5 Throwing error with message:",e.message);let a=e.message||"Failed to create job ticket";if(422===f.status&&(a="Validation error: Please check all required fields are filled correctly",e.detail&&Array.isArray(e.detail))){const t=e.detail.map((e=>{var t;return"".concat(null===(t=e.loc)||void 0===t?void 0:t.join("."),": ").concat(e.msg)})).join(", ");a="Validation errors: ".concat(t)}throw new Error(a)}const v=await f.json();console.log("\u2705 Successfully created job ticket:",v),w.oR.success(u("manager.jobTickets.messages.createSuccess")),console.log("\ud83c\udf89 Success toast shown"),l?(console.log("\ud83d\udcde Calling onJobTicketCreated callback"),l(v)):console.log("\u26a0\ufe0f No onJobTicketCreated callback provided"),console.log("\ud83d\udd04 Resetting form and closing modal"),b(),a(),console.log("\u2728 Job ticket creation completed successfully")}catch(h){console.error("\ud83d\udc80 COMPREHENSIVE ERROR DEBUG:"),console.error("Error object:",h),console.error("Error message:",h.message),console.error("Error stack:",h.stack),console.error("Error name:",h.name),console.error("Error cause:",h.cause);const e=h.message||u("manager.jobTickets.messages.createError");console.error("\ud83d\udea8 Showing error toast:",e),w.oR.error(e)}finally{console.log("\ud83c\udfc1 Setting isSubmitting to false"),g(!1)}})),className:"space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"company_name",className:"block text-sm font-medium text-gray-300 mb-2",children:u("manager.jobTickets.createModal.fields.companyName")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"company_name",type:"text"},h("company_name",{required:"Company name is required"})),{},{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter customer company name"})),v.company_name&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:v.company_name.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"customer_name",className:"block text-sm font-medium text-gray-300 mb-2",children:u("manager.jobTickets.createModal.fields.customerName")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"customer_name",type:"text"},h("customer_name",{required:"Customer name is required"})),{},{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter customer name"})),v.customer_name&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:v.customer_name.message})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-300 mb-2",children:u("manager.jobTickets.createModal.fields.location")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"location",type:"text"},h("location",{required:"Location is required"})),{},{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter job location"})),v.location&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:v.location.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-300 mb-2",children:u("manager.jobTickets.createModal.fields.workDescription")}),(0,c.jsx)("textarea",(0,i.A)((0,i.A)({id:"description"},h("description",{required:"Work description is required"})),{},{rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the work performed"})),v.description&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:v.description.message})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-white",children:"Work Hours"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"work_start_time",className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Time"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"work_start_time",type:"time"},h("work_start_time")),{},{className:"w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"work_end_time",className:"block text-sm font-medium text-gray-300 mb-2",children:"End Time"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"work_end_time",type:"time"},h("work_end_time")),{},{className:"w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"total_work_hours",className:"block text-sm font-medium text-gray-300 mb-2",children:"Total Work Hours"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"total_work_hours",type:"number",step:"0.25"},h("total_work_hours",{min:0})),{},{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.0"}))]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-white",children:"Travel Hours"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"drive_start_time",className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Time"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"drive_start_time",type:"time"},h("drive_start_time")),{},{className:"w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"drive_end_time",className:"block text-sm font-medium text-gray-300 mb-2",children:"End Time"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"drive_end_time",type:"time"},h("drive_end_time")),{},{className:"w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"total_travel_hours",className:"block text-sm font-medium text-gray-300 mb-2",children:"Total Travel Hours"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"total_travel_hours",type:"number",step:"0.25"},h("total_travel_hours",{min:0})),{},{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.0"}))]})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"additional_notes",className:"block text-sm font-medium text-gray-300 mb-2",children:"Additional Notes (Optional)"}),(0,c.jsx)("textarea",(0,i.A)((0,i.A)({id:"additional_notes"},h("additional_notes")),{},{rows:2,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Any additional notes or comments"}))]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-700",children:[(0,c.jsx)("button",{type:"button",onClick:A,disabled:x,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors duration-200 disabled:opacity-50",children:u("common.cancel")}),(0,c.jsx)("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-orange-600 hover:bg-orange-700 disabled:bg-orange-800 text-white font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:cursor-not-allowed",children:x?(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),u("common.creating")]}):u("manager.jobTickets.createModal.submit")})]})]})})},B=e=>{let{isOpen:t,onClose:a,jobTicket:n,onJobTicketUpdated:o}=e;const{t:l}=(0,r.ok)(),[d,m]=(0,s.useState)(!1),{register:x,handleSubmit:g,reset:h,formState:{errors:p},setValue:b}=(0,J.mN)();(0,s.useEffect)((()=>{n&&t&&(console.log("\ud83d\udcdd Pre-populating edit form with job ticket:",n),b("companyName",n.company_name||""),b("customerName",n.customer_name||""),b("location",n.location||""),b("workDescription",n.work_description||""),b("workStartTime",n.work_start_time||""),b("workEndTime",n.work_end_time||""),b("driveStartTime",n.drive_start_time||""),b("driveEndTime",n.drive_end_time||""),b("totalWorkHours",n.work_total_hours||""),b("totalTravelHours",n.drive_total_hours||""),b("additionalNotes",n.additional_notes||""),b("equipment",n.equipment||""),b("workType",n.work_type||""))}),[n,t,b]);const j=()=>{h(),a()};return t&&n?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,c.jsxs)("div",{className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-white",children:l("manager.jobTickets.editModal.title")}),(0,c.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:[l("manager.jobTickets.editModal.subtitle")," ",n.ticket_number]})]}),(0,c.jsx)("button",{onClick:j,className:"text-gray-400 hover:text-white transition-colors",children:(0,c.jsx)(u.A,{className:"h-6 w-6"})})]}),(0,c.jsxs)("form",{onSubmit:g((async e=>{if(n){m(!0);try{console.log("\ud83d\udce4 Updating job ticket:",n.id),console.log("\ud83d\udccb Form data:",e);const t={company_name:e.companyName,customer_name:e.customerName,location:e.location,work_description:e.workDescription,work_start_time:e.workStartTime,work_end_time:e.workEndTime,drive_start_time:e.driveStartTime,drive_end_time:e.driveEndTime,work_total_hours:parseFloat(e.totalWorkHours)||0,drive_total_hours:parseFloat(e.totalTravelHours)||0,equipment:e.equipment,work_type:e.workType,additional_notes:e.additionalNotes};console.log("\ud83d\udce6 Prepared payload:",t);const s=await(0,N.Ud)("/job-tickets/".concat(n.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const e=await s.json();throw console.error("\u274c Error updating job ticket:",e),new Error(e.detail||"Failed to update job ticket")}{const e=await s.json();console.log("\u2705 Job ticket updated successfully:",e),w.oR.success(l("manager.jobTickets.messages.editSuccess")),o&&o(e),h(),a()}}catch(t){console.error("\u274c Error updating job ticket:",t),w.oR.error(l("manager.jobTickets.messages.editError"))}finally{m(!1)}}})),className:"p-6 space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"companyName",className:"block text-sm font-medium text-gray-300 mb-2",children:[l("manager.jobTickets.createModal.fields.companyName")," *"]}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"companyName",type:"text"},x("companyName",{required:"Company name is required"})),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter company name"})),p.companyName&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:p.companyName.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"customerName",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.customerName")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"customerName",type:"text"},x("customerName")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter customer name"}))]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-300 mb-2",children:[l("manager.jobTickets.createModal.fields.location")," *"]}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"location",type:"text"},x("location",{required:"Location is required"})),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter location"})),p.location&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:p.location.message})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"workType",className:"block text-sm font-medium text-gray-300 mb-2",children:"Work Type"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"workType",type:"text"},x("workType")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter work type"}))]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"equipment",className:"block text-sm font-medium text-gray-300 mb-2",children:"Equipment"}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"equipment",type:"text"},x("equipment")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter equipment details"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"workDescription",className:"block text-sm font-medium text-gray-300 mb-2",children:[l("manager.jobTickets.createModal.fields.workDescription")," *"]}),(0,c.jsx)("textarea",(0,i.A)((0,i.A)({id:"workDescription"},x("workDescription",{required:"Work description is required"})),{},{rows:4,className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the work performed"})),p.workDescription&&(0,c.jsx)("p",{className:"mt-1 text-sm text-red-400",children:p.workDescription.message})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-white",children:"Work Time"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"workStartTime",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.workStartTime")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"workStartTime",type:"time"},x("workStartTime")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"workEndTime",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.workEndTime")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"workEndTime",type:"time"},x("workEndTime")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"totalWorkHours",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.totalWorkHours")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"totalWorkHours",type:"number",step:"0.5",min:"0"},x("totalWorkHours")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.0"}))]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("h3",{className:"text-lg font-medium text-white",children:"Travel Time"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"driveStartTime",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.driveStartTime")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"driveStartTime",type:"time"},x("driveStartTime")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"driveEndTime",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.driveEndTime")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"driveEndTime",type:"time"},x("driveEndTime")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"totalTravelHours",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.totalTravelHours")}),(0,c.jsx)("input",(0,i.A)((0,i.A)({id:"totalTravelHours",type:"number",step:"0.5",min:"0"},x("totalTravelHours")),{},{className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.0"}))]})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"additionalNotes",className:"block text-sm font-medium text-gray-300 mb-2",children:l("manager.jobTickets.createModal.fields.additionalNotes")}),(0,c.jsx)("textarea",(0,i.A)((0,i.A)({id:"additionalNotes"},x("additionalNotes")),{},{rows:3,className:"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter any additional notes"}))]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-slate-700",children:[(0,c.jsx)("button",{type:"button",onClick:j,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",disabled:d,children:l("common.cancel")}),(0,c.jsx)("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l(d?"common.saving":"common.save")})]})]})]})}):null},V=()=>{const{t:e}=(0,r.ok)(),{validateAccess:t}=d(),[a,n]=(0,s.useState)([]),[i,o]=(0,s.useState)(!0),[l,m]=(0,s.useState)(null),[u,x]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),[j,f]=(0,s.useState)([]),[v,y]=(0,s.useState)(!1),[_,T]=(0,s.useState)(!1),[S,F]=(0,s.useState)(null),M=(0,s.useCallback)((async()=>{try{o(!0),m(null),console.log("\ud83c\udfab Fetching job tickets...");const e=await(0,N.Ud)("/job-tickets/?limit=100");if(!e.ok){const t=await e.text();throw console.error("\u274c Response error:",e.status,t),new Error("Failed to fetch job tickets: ".concat(e.status))}{const t=await e.json();console.log("\u2705 Job tickets fetched:",t),n(t.job_tickets||[])}}catch(l){console.error("\u274c Error fetching job tickets:",l),m(l.message)}finally{o(!1)}}),[]),E=(0,s.useCallback)((e=>{console.log("\ud83c\udd95 Job ticket created, refreshing list..."),M()}),[M]),D=(0,s.useCallback)((t=>{console.log("\ud83d\udcdd Job ticket updated, refreshing list..."),M(),w.oR.success(e("manager.jobTickets.messages.editSuccess"))}),[M,e]),J=(0,s.useCallback)((async(t,a)=>{try{console.log("\ud83d\uddd1\ufe0f Deleting job ticket ".concat(a," (ID: ").concat(t,")..."));const s=await(0,N.Ud)("/job-tickets/".concat(t),{method:"DELETE"});if(!s.ok){const e=await s.text();throw console.error("\u274c Delete response error:",s.status,e),new Error("Failed to delete job ticket: ".concat(s.status))}console.log("\u2705 Job ticket deleted successfully"),w.oR.success(e("manager.jobTickets.messages.deleteSuccess")),M()}catch(l){console.error("\u274c Error deleting job ticket:",l),w.oR.error(e("manager.jobTickets.messages.deleteError"))}}),[M,e]);(0,s.useEffect)((()=>{M()}),[M]);const V=(0,s.useCallback)((()=>{const e=a.length,t=a.filter((e=>e.invoice_id)).length;return{totalTickets:e,assignedToInvoice:t,notAssigned:e-t}}),[a]),z=e=>e?parseFloat(e).toFixed(1):"0",{loading:W,error:K}=d();if(W)return(0,c.jsx)("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,c.jsx)("p",{className:"text-white",children:e("common.loading")})]})});if(K)return(0,c.jsx)("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Access Denied"}),(0,c.jsx)("p",{className:"text-gray-300 mb-4",children:K}),(0,c.jsx)("button",{onClick:()=>window.history.back(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:e("common.goHome")})]})});if(!t())return null;const G=V();return i?(0,c.jsx)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-6",children:(0,c.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),(0,c.jsx)("span",{className:"ml-3 text-gray-400",children:e("common.loading")})]})}):(0,c.jsxs)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-6",children:[(0,c.jsxs)("div",{className:"mb-8 flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:e("manager.jobTickets.title")}),(0,c.jsx)("p",{className:"text-gray-400",children:e("manager.jobTickets.subtitle")})]}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 lg:flex-shrink-0",children:[(0,c.jsx)("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 focus:bg-orange-700 text-white font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-slate-900",children:e("manager.jobTickets.actions.createJobTicket")}),(0,c.jsx)("button",{onClick:()=>{const e=a.filter((e=>j.includes(e.id))),t=L(e);t.isValid?y(!0):(F(t),T(!0))},className:"px-4 py-2 bg-green-600 hover:bg-green-700 focus:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200",children:e("manager.jobTickets.actions.createInvoice")})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(R.A,{className:"h-8 w-8 text-blue-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:a.length}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.jobTickets.stats.totalTickets")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(q.A,{className:"h-8 w-8 text-green-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:G.assignedToInvoice}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.jobTickets.stats.assignedToInvoice")})]})]})}),(0,c.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 shadow-lg",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(k.A,{className:"h-8 w-8 text-yellow-500"})}),(0,c.jsxs)("div",{className:"ml-4",children:[(0,c.jsx)("p",{className:"text-2xl font-bold text-white",children:G.notAssigned}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:e("manager.jobTickets.stats.notAssigned")})]})]})})]}),(0,c.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-lg",children:[(0,c.jsx)("div",{className:"px-6 py-4 border-b border-gray-700",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-white",children:e("manager.jobTickets.table.title")}),j.length>0&&(0,c.jsxs)("div",{className:"flex items-center gap-4 bg-blue-900/20 border border-blue-700 rounded-lg px-4 py-2",children:[(0,c.jsxs)("span",{className:"text-sm text-blue-300",children:[j.length," ticket",1!==j.length?"s":""," selected"]}),(0,c.jsx)("button",{onClick:()=>{const e=a.filter((e=>j.includes(e.id))),t=L(e);t.isValid?y(!0):(F(t),T(!0))},className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded transition-colors duration-200",children:"Create Invoice from Selected"}),(0,c.jsx)("button",{onClick:()=>f([]),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white text-sm font-medium rounded transition-colors duration-200",children:"Clear Selection"})]})]})}),l?(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,c.jsx)(A.A,{className:"h-12 w-12 text-red-500 mb-4"}),(0,c.jsx)("p",{className:"text-red-400 mb-4",children:e("manager.jobTickets.messages.loadError")}),(0,c.jsx)("button",{onClick:M,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200",children:e("common.retry")})]}):0===a.length?(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,c.jsx)(R.A,{className:"h-12 w-12 text-gray-500 mb-4"}),(0,c.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:e("manager.jobTickets.empty.title")}),(0,c.jsx)("p",{className:"text-gray-400 text-center max-w-md",children:e("manager.jobTickets.empty.description")})]}):(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,c.jsx)("thead",{className:"bg-gray-700",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:(0,c.jsx)("input",{type:"checkbox",checked:j.length===a.length&&a.length>0,onChange:e=>{e.target.checked?f(a.map((e=>e.id))):f([])},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded bg-gray-700 border-gray-600"})}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.jobTickets.table.headers.ticketNumber")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.jobTickets.table.headers.submittedBy")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.jobTickets.table.headers.companyName")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider hidden sm:table-cell",children:e("manager.jobTickets.table.headers.workHours")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider hidden sm:table-cell",children:e("manager.jobTickets.table.headers.travelHours")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.jobTickets.table.headers.invoiceLink")}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:e("manager.jobTickets.table.headers.actions")})]})}),(0,c.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:a.map((t=>(0,c.jsxs)("tr",{className:"hover:bg-gray-750 transition-colors duration-150",children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:(0,c.jsx)("input",{type:"checkbox",checked:j.includes(t.id),onChange:e=>{e.target.checked?f([...j,t.id]):f(j.filter((e=>e!==t.id)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded bg-gray-700 border-gray-600"})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:t.ticket_number}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.submitted_by_name||e("common.notAvailable")}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.company_name||e("common.notAvailable")}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 hidden sm:table-cell",children:z(t.work_total_hours)}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 hidden sm:table-cell",children:z(t.drive_total_hours)}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.invoice_id?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"),children:t.invoice_id?e("manager.jobTickets.table.status.linked"):e("manager.jobTickets.table.status.notLinked")})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("button",{onClick:()=>{b(t),h(!0)},className:"text-orange-400 hover:text-orange-300 p-1 rounded transition-colors duration-200",title:e("common.view"),children:(0,c.jsx)(U.A,{className:"h-4 w-4"})}),(0,c.jsx)("button",{onClick:()=>{window.confirm(e("manager.jobTickets.confirmDelete"))&&J(t.id,t.ticket_number)},className:"text-red-400 hover:text-red-300 p-1 rounded transition-colors duration-200",title:e("common.delete"),children:(0,c.jsx)(I.A,{className:"h-4 w-4"})})]})})]},t.id)))})]})})]}),u&&(0,c.jsx)(H,{isOpen:u,onClose:()=>x(!1),onJobTicketCreated:E}),g&&p&&(0,c.jsx)(B,{isOpen:g,onClose:()=>{h(!1),b(null)},jobTicket:p,onJobTicketUpdated:D}),v&&(0,c.jsx)(O,{isOpen:v,onClose:()=>{y(!1),f([])},onInvoiceCreated:e=>{console.log("\u2705 Invoice created from job tickets:",e),y(!1),f([]),M()},selectedJobTickets:a.filter((e=>j.includes(e.id))),mode:j.length>0?"jobTickets":"manual"}),_&&(0,c.jsx)(C.A,{isOpen:_,onClose:()=>T(!1),title:e("manager.jobTickets.warning.title"),content:S?P(S.error,S.customerCompanies):e("manager.jobTickets.warning.content"),actions:[{label:e("common.ok"),onClick:()=>T(!1)}]})]})},z=()=>{const{t:e}=(0,r.ok)(),{auditLogs:t,loadingAuditLogs:a,auditError:o}=(0,n.zS)(),{validateAccess:m}=d(),[u,g]=(0,s.useState)([]),[h,p]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[y,N]=(0,s.useState)({category:"",action:"",user:"",dateFrom:"",dateTo:"",search:""}),[w,k]=(0,s.useState)({page:1,limit:50,total:0,totalPages:0}),[_,T]=(0,s.useState)("timestamp"),[A,C]=(0,s.useState)("desc"),[S,F]=(0,s.useState)(!1),M=(0,s.useCallback)((async()=>{const{hasAccess:t}=await m("audit_logs");if(t){p(!0),j(null);try{const e=(0,i.A)({page:w.page,limit:w.limit,sort_by:_,sort_order:A},y);Object.keys(e).forEach((t=>{e[t]||delete e[t]}));const t=await(0,l.Dn)(e);t.success||void 0!==t.logs?(g(t.logs||[]),k((e=>(0,i.A)((0,i.A)({},e),{},{total:t.total||0,totalPages:Math.ceil((t.total||0)/e.limit)}))),t.success&&j(null),t.message&&0===t.logs.length&&console.log("Audit logs info:",t.message)):!t.error||t.error.includes("Authentication")||t.error.includes("token")?(g([]),k((e=>(0,i.A)((0,i.A)({},e),{},{total:0,totalPages:0}))),j(null)):j(t.error)}catch(b){console.error("Error loading audit logs:",b),j(e("common.errorOccurred")),g([]),k((e=>(0,i.A)((0,i.A)({},e),{},{total:0,totalPages:0})))}finally{p(!1)}}else j(e("common.accessDenied"))}),[w.page,w.limit,_,A,y,m,e]);(0,s.useEffect)((()=>{M()}),[M]);const E=(e,t)=>{N((a=>(0,i.A)((0,i.A)({},a),{},{[e]:t}))),k((e=>(0,i.A)((0,i.A)({},e),{},{page:1})))},I=e=>{_===e?C((e=>"asc"===e?"desc":"asc")):(T(e),C("desc")),k((e=>(0,i.A)((0,i.A)({},e),{},{page:1})))},O=e=>{k((t=>(0,i.A)((0,i.A)({},t),{},{page:e})))},D=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"security":return"bg-danger";case"user":return"bg-primary";case"company":return"bg-info";case"technician":return"bg-success";case"system":return"bg-secondary";default:return"bg-light text-dark"}},{categories:L,actions:P,users:R}={categories:[...new Set(u.map((e=>e.category)).filter(Boolean))],actions:[...new Set(u.map((e=>e.action)).filter(Boolean))],users:[...new Set(u.map((e=>e.user_name||e.user_email)).filter(Boolean))]};return(0,c.jsxs)("div",{className:"audit-logs",children:[(0,c.jsx)("div",{className:"logs-header mb-4",children:(0,c.jsxs)("div",{className:"row align-items-center",children:[(0,c.jsxs)("div",{className:"col",children:[(0,c.jsx)("h2",{className:"h4 mb-1",children:e("manager.auditLogs.title")}),(0,c.jsx)("p",{className:"text-muted mb-0",children:e("manager.auditLogs.subtitle")})]}),(0,c.jsx)("div",{className:"col-auto",children:(0,c.jsx)("button",{className:"btn btn-outline-primary",onClick:async()=>{const{hasAccess:t}=await m("data_export");if(t){F(!0);try{const t=(0,i.A)((0,i.A)({},y),{},{sort_by:_,sort_order:A});Object.keys(t).forEach((e=>{t[e]||delete t[e]}));const a=await(0,l.d8)(t);if(!a.success)throw new Error(a.error||"Export failed");{const t=new Blob([a.csv],{type:"text/csv"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download="audit-logs-".concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s),v({type:"success",message:e("manager.auditLogs.messages.exportSuccess")})}}catch(b){console.error("Error exporting audit logs:",b),v({type:"error",message:b.message||e("common.errorOccurred")})}finally{F(!1)}}else v({type:"error",message:e("common.accessDenied")})},disabled:S||0===u.length,children:S?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),e("manager.auditLogs.exporting")]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("i",{className:"bi bi-download me-2"}),e("manager.auditLogs.exportLogs")]})})})]})}),(0,c.jsx)("div",{className:"filters-section card mb-4",children:(0,c.jsxs)("div",{className:"card-body",children:[(0,c.jsxs)("div",{className:"row g-3 align-items-end",children:[(0,c.jsxs)("div",{className:"col-md-2",children:[(0,c.jsx)("label",{className:"form-label",children:e("manager.auditLogs.filters.category")}),(0,c.jsxs)("select",{className:"form-select",value:y.category,onChange:e=>E("category",e.target.value),children:[(0,c.jsx)("option",{value:"",children:e("common.all")}),Object.values(l.dU).map((t=>(0,c.jsx)("option",{value:t,children:e("manager.auditLogs.categories.".concat(t.toLowerCase()))},t)))]})]}),(0,c.jsxs)("div",{className:"col-md-2",children:[(0,c.jsx)("label",{className:"form-label",children:e("manager.auditLogs.filters.action")}),(0,c.jsxs)("select",{className:"form-select",value:y.action,onChange:e=>E("action",e.target.value),children:[(0,c.jsx)("option",{value:"",children:e("common.all")}),P.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]})]}),(0,c.jsxs)("div",{className:"col-md-2",children:[(0,c.jsx)("label",{className:"form-label",children:e("manager.auditLogs.filters.user")}),(0,c.jsxs)("select",{className:"form-select",value:y.user,onChange:e=>E("user",e.target.value),children:[(0,c.jsx)("option",{value:"",children:e("common.all")}),R.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]})]}),(0,c.jsxs)("div",{className:"col-md-2",children:[(0,c.jsx)("label",{className:"form-label",children:e("manager.auditLogs.filters.dateFrom")}),(0,c.jsx)("input",{type:"date",className:"form-control",value:y.dateFrom,onChange:e=>E("dateFrom",e.target.value)})]}),(0,c.jsxs)("div",{className:"col-md-2",children:[(0,c.jsx)("label",{className:"form-label",children:e("manager.auditLogs.filters.dateTo")}),(0,c.jsx)("input",{type:"date",className:"form-control",value:y.dateTo,onChange:e=>E("dateTo",e.target.value)})]}),(0,c.jsx)("div",{className:"col-md-2",children:(0,c.jsxs)("div",{className:"d-flex gap-2",children:[(0,c.jsx)("button",{className:"btn btn-outline-secondary",onClick:()=>{N({category:"",action:"",user:"",dateFrom:"",dateTo:"",search:""}),k((e=>(0,i.A)((0,i.A)({},e),{},{page:1})))},title:e("manager.auditLogs.clearFilters"),children:(0,c.jsx)("i",{className:"bi bi-x-circle"})}),(0,c.jsx)("button",{className:"btn btn-primary",onClick:M,disabled:h,title:e("common.refresh"),children:(0,c.jsx)("i",{className:"bi bi-arrow-clockwise"})})]})})]}),(0,c.jsxs)("div",{className:"row g-3 mt-2",children:[(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsx)("input",{type:"text",className:"form-control",placeholder:e("manager.auditLogs.filters.searchPlaceholder"),value:y.search,onChange:e=>E("search",e.target.value)})}),(0,c.jsx)("div",{className:"col-md-6",children:(0,c.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,c.jsx)("small",{className:"text-muted",children:e("manager.auditLogs.totalLogs",{count:w.total})}),(0,c.jsxs)("select",{className:"form-select form-select-sm",style:{width:"auto"},value:w.limit,onChange:e=>k((t=>(0,i.A)((0,i.A)({},t),{},{limit:parseInt(e.target.value),page:1}))),children:[(0,c.jsx)("option",{value:25,children:"25"}),(0,c.jsx)("option",{value:50,children:"50"}),(0,c.jsx)("option",{value:100,children:"100"})]}),(0,c.jsx)("small",{className:"text-muted",children:e("manager.auditLogs.perPage")})]})})]})]})}),(0,c.jsx)("div",{className:"logs-table card",children:(0,c.jsx)("div",{className:"card-body p-0",children:h?(0,c.jsxs)("div",{className:"text-center py-5",children:[(0,c.jsx)("div",{className:"spinner-border",role:"status",children:(0,c.jsx)("span",{className:"visually-hidden",children:e("manager.auditLogs.messages.loadingLogs")})}),(0,c.jsx)("p",{className:"mt-2 text-muted",children:e("manager.auditLogs.messages.loadingLogs")})]}):b?(0,c.jsxs)("div",{className:"alert alert-danger m-3",role:"alert",children:[(0,c.jsx)("i",{className:"bi bi-exclamation-triangle me-2"}),b]}):0===u.length?(0,c.jsxs)("div",{className:"text-center py-5",children:[(0,c.jsx)("i",{className:"bi bi-journal-text display-1 text-muted"}),(0,c.jsx)("p",{className:"mt-3 text-muted",children:e("manager.auditLogs.messages.noLogsFound")})]}):(0,c.jsx)("div",{className:"table-responsive",children:(0,c.jsxs)("table",{className:"table table-hover mb-0",children:[(0,c.jsx)("thead",{className:"table-light",children:(0,c.jsxs)("tr",{children:[(0,c.jsxs)("th",{className:"sortable",onClick:()=>I("timestamp"),children:[e("manager.auditLogs.timestamp"),"timestamp"===_&&(0,c.jsx)("i",{className:"bi bi-arrow-".concat("asc"===A?"up":"down"," ms-1")})]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>I("category"),children:[e("manager.auditLogs.category"),"category"===_&&(0,c.jsx)("i",{className:"bi bi-arrow-".concat("asc"===A?"up":"down"," ms-1")})]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>I("action"),children:[e("manager.auditLogs.action"),"action"===_&&(0,c.jsx)("i",{className:"bi bi-arrow-".concat("asc"===A?"up":"down"," ms-1")})]}),(0,c.jsxs)("th",{className:"sortable",onClick:()=>I("user_name"),children:[e("manager.auditLogs.user"),"user_name"===_&&(0,c.jsx)("i",{className:"bi bi-arrow-".concat("asc"===A?"up":"down"," ms-1")})]}),(0,c.jsx)("th",{children:e("manager.auditLogs.description")}),(0,c.jsx)("th",{children:e("manager.auditLogs.ipAddress")})]})}),(0,c.jsx)("tbody",{children:u.map((t=>{const a=(e=>{const t=new Date(e.timestamp).toLocaleString(),a=e.category||"System",s=e.action||"Unknown",r=e.user_name||e.user_email||"System",n=e.details?JSON.stringify(e.details,null,2):"";return(0,i.A)((0,i.A)({},e),{},{formattedTimestamp:t,formattedCategory:a,formattedAction:s,formattedUser:r,formattedDetails:n})})(t);return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:(0,c.jsx)("small",{className:"text-muted",children:a.formattedTimestamp})}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"badge ".concat(D(t.category)),children:e("manager.auditLogs.categories.".concat((t.category||"system").toLowerCase()))})}),(0,c.jsx)("td",{children:(0,c.jsx)("code",{className:"small",children:t.action})}),(0,c.jsx)("td",{children:(0,c.jsxs)("div",{className:"d-flex align-items-center",children:[(0,c.jsx)("div",{className:"avatar-sm me-2",children:(0,c.jsx)("div",{className:"avatar-initials-sm",children:(a.formattedUser[0]||"S").toUpperCase()})}),(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"small fw-medium",children:a.formattedUser})})]})}),(0,c.jsxs)("td",{children:[(0,c.jsxs)("div",{className:"log-description",children:[t.description||t.action,t.details&&(0,c.jsx)("button",{className:"btn btn-link btn-sm p-0 ms-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#details-".concat(t.id),"aria-expanded":"false",children:(0,c.jsx)("i",{className:"bi bi-info-circle"})})]}),t.details&&(0,c.jsx)("div",{className:"collapse mt-2",id:"details-".concat(t.id),children:(0,c.jsx)("div",{className:"card card-body small",children:(0,c.jsx)("pre",{className:"mb-0",children:a.formattedDetails})})})]}),(0,c.jsx)("td",{children:(0,c.jsx)("small",{className:"text-muted font-monospace",children:t.ip_address||"N/A"})})]},t.id)}))})]})})})}),w.totalPages>1&&(0,c.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[(0,c.jsx)("div",{children:(0,c.jsx)("small",{className:"text-muted",children:e("manager.auditLogs.showingResults",{start:(w.page-1)*w.limit+1,end:Math.min(w.page*w.limit,w.total),total:w.total})})}),(0,c.jsx)("nav",{children:(0,c.jsxs)("ul",{className:"pagination pagination-sm mb-0",children:[(0,c.jsx)("li",{className:"page-item ".concat(1===w.page?"disabled":""),children:(0,c.jsx)("button",{className:"page-link",onClick:()=>O(w.page-1),disabled:1===w.page,children:(0,c.jsx)("i",{className:"bi bi-chevron-left"})})}),Array.from({length:Math.min(5,w.totalPages)},((e,t)=>{const a=Math.max(1,Math.min(w.totalPages-4,w.page-2))+t;return(0,c.jsx)("li",{className:"page-item ".concat(w.page===a?"active":""),children:(0,c.jsx)("button",{className:"page-link",onClick:()=>O(a),children:a})},a)})),(0,c.jsx)("li",{className:"page-item ".concat(w.page===w.totalPages?"disabled":""),children:(0,c.jsx)("button",{className:"page-link",onClick:()=>O(w.page+1),disabled:w.page===w.totalPages,children:(0,c.jsx)("i",{className:"bi bi-chevron-right"})})})]})})]}),f&&(0,c.jsx)(x,{type:f.type,message:f.message,show:!0,onClose:()=>v(null)})]})},W=e=>{const t=e.replace(/\D/g,"").substring(0,10);return t.length<=3?t:t.length<=6?"(".concat(t.substring(0,3),") ").concat(t.substring(3)):"(".concat(t.substring(0,3),") ").concat(t.substring(3,6),"-").concat(t.substring(6))},K=e=>{let{isOpen:t,onClose:a,onSuccess:n}=e;const{t:d}=(0,r.ok)(),{user:m}=(0,o.As)(),[x,g]=(0,s.useState)("email"),[h,p]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[y,w]=(0,s.useState)({fullName:"",email:"",phone:"",password:"",confirmPassword:""}),[k,_]=(0,s.useState)({techName:"",email:""}),[T,A]=(0,s.useState)({techName:"",phone:""});(0,s.useEffect)((()=>{j(null),v(null)}),[x]),(0,s.useEffect)((()=>{t||(g("email"),p(!1),j(null),v(null),w({fullName:"",email:"",phone:"",password:"",confirmPassword:""}),_({techName:"",email:""}),A({techName:"",phone:""}))}),[t]);if(!t)return null;return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:d("manager.techManagement.inviteForm.title")}),(0,c.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,c.jsx)(u.A,{className:"h-6 w-6"})})]}),(0,c.jsx)("div",{className:"border-b border-gray-200",children:(0,c.jsxs)("nav",{className:"flex space-x-8 px-6",children:[(0,c.jsx)("button",{onClick:()=>g("create"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("create"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:d("manager.techManagement.inviteForm.createTab")}),(0,c.jsx)("button",{onClick:()=>g("email"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("email"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:d("manager.techManagement.inviteForm.emailTab")}),(0,c.jsx)("button",{onClick:()=>g("sms"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("sms"===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:d("manager.techManagement.inviteForm.smsTab")})]})}),(0,c.jsxs)("div",{className:"p-6",children:[f&&(0,c.jsx)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,c.jsx)("p",{className:"text-green-800",children:f})}),b&&(0,c.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,c.jsx)("p",{className:"text-red-800",children:b})}),"create"===x&&(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),p(!0),j(null),y.password!==y.confirmPassword)return j(d("manager.techManagement.inviteForm.passwordMismatch")),void p(!1);if(y.password.length<8)return j(d("manager.techManagement.inviteForm.passwordMinLengthError")),void p(!1);try{const e=await(0,N.Ud)("/invitations/create-technician-direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y.email,name:y.fullName,job_type:"other",temporary_password:y.password})});if(!e.ok){let a;try{a=await e.json()}catch(t){try{a={detail:await e.text()}}catch(s){a={detail:"HTTP ".concat(e.status,": ").concat(e.statusText)}}}const r=new Error(a.detail||d("manager.techManagement.inviteForm.createError"));throw r.response=e,r.responseData=a,r}const r=await e.json();v(d("manager.techManagement.inviteForm.createSuccess",{name:y.fullName})),n&&n(r),setTimeout((()=>{a()}),2e3)}catch(r){console.error("Tech account creation error:",r);let e=d("manager.techManagement.inviteForm.createError"),t=[];try{r.response?(t.push("Status: ".concat(r.response.status)),t.push("Status Text: ".concat(r.response.statusText)),t.push("URL: ".concat(r.response.url||"/invitations/create-technician-direct")),r.responseData&&("string"===typeof r.responseData?t.push("Response: ".concat(r.responseData)):r.responseData.detail?(e=r.responseData.detail,t.push("Detail: ".concat(r.responseData.detail))):t.push("Response: ".concat(JSON.stringify(r.responseData))))):r.message&&(e=r.message,t.push("Error: ".concat(r.message)))}catch(i){t.push("Error processing error: ".concat(i.message))}console.error("Comprehensive error details:",{originalError:r,errorMessage:e,errorDetails:t,timestamp:(new Date).toISOString(),url:"/invitations/create-technician-direct",method:"POST",requestBody:{email:y.email,name:y.fullName,job_type:"other",temporary_password:y.password}});!1&&t.length>0?j("".concat(e,"\n\nDEBUG INFO:\n").concat(t.join("\n"))):j(e)}finally{p(!1)}},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.fullNameRequired")}),(0,c.jsx)("input",{type:"text",required:!0,value:y.fullName,onChange:e=>w((0,i.A)((0,i.A)({},y),{},{fullName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterFullName")})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.emailAddressRequired")}),(0,c.jsx)("input",{type:"email",required:!0,value:y.email,onChange:e=>w((0,i.A)((0,i.A)({},y),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterEmail")})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.phoneNumber")}),(0,c.jsx)("input",{type:"tel",value:W(y.phone),onChange:e=>{const t=e.target.value.replace(/\D/g,"");w((0,i.A)((0,i.A)({},y),{},{phone:t}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterPhone")})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[d("manager.techManagement.inviteForm.passwordRequired")," ",(0,c.jsx)("span",{className:"text-gray-400 font-normal",children:d("manager.techManagement.inviteForm.passwordMinLength")})]}),(0,c.jsx)("input",{type:"password",required:!0,value:y.password,onChange:e=>w((0,i.A)((0,i.A)({},y),{},{password:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterPassword")})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.confirmPasswordRequired")}),(0,c.jsx)("input",{type:"password",required:!0,value:y.confirmPassword,onChange:e=>w((0,i.A)((0,i.A)({},y),{},{confirmPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.confirmPasswordPlaceholder")})]}),(0,c.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d(h?"manager.techManagement.inviteForm.creating":"manager.techManagement.inviteForm.createTechnician")})]}),"email"===x&&(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(!0),j(null);try{const e=await(0,N.Ud)("/tech-invites/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tech_name:k.techName,email:k.email})});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to send email invitation")}await e.json();await(0,l.Ip)(l.Km.TECHNICIAN_INVITED,k.email,{tech_name:k.techName,invitation_method:"email"}),v(d("manager.techManagement.inviteForm.emailSent")),_({techName:"",email:""}),setTimeout((()=>{a()}),2e3)}catch(t){console.error("Email invitation error:",t),j(t.message)}finally{p(!1)}},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.technicianNameRequired")}),(0,c.jsx)("input",{type:"text",required:!0,value:k.techName,onChange:e=>_((0,i.A)((0,i.A)({},k),{},{techName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterTechnicianName")})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.emailAddressRequired")}),(0,c.jsx)("input",{type:"email",required:!0,value:k.email,onChange:e=>_((0,i.A)((0,i.A)({},k),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterEmail")})]}),(0,c.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,c.jsx)("p",{className:"text-sm text-blue-800",children:d("manager.techManagement.inviteForm.emailInviteInfo")})}),(0,c.jsx)("button",{type:"submit",disabled:h,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d(h?"manager.techManagement.inviteForm.sending":"manager.techManagement.inviteForm.sendEmailInvitation")})]}),"sms"===x&&(0,c.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(!0),j(null);try{const e=await(0,N.Ud)("/tech-invites/send-sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tech_name:T.techName,phone:T.phone})});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to send SMS invitation")}await e.json();await(0,l.Ip)(l.Km.TECHNICIAN_INVITED,T.phone,{tech_name:T.techName,invitation_method:"sms"}),v(d("manager.techManagement.inviteForm.smsSent")),A({techName:"",phone:""}),setTimeout((()=>{a()}),2e3)}catch(t){console.error("SMS invitation error:",t),j(t.message)}finally{p(!1)}},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.technicianNameRequired")}),(0,c.jsx)("input",{type:"text",required:!0,value:T.techName,onChange:e=>A((0,i.A)((0,i.A)({},T),{},{techName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterTechnicianName")})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d("manager.techManagement.inviteForm.phoneNumberRequired")}),(0,c.jsx)("input",{type:"tel",required:!0,value:W(T.phone),onChange:e=>{const t=e.target.value.replace(/\D/g,"");A((0,i.A)((0,i.A)({},T),{},{phone:t}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:d("manager.techManagement.inviteForm.enterPhone")})]}),(0,c.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,c.jsx)("p",{className:"text-sm text-yellow-800",children:d("manager.techManagement.inviteForm.smsInviteInfo")})}),(0,c.jsx)("button",{type:"submit",disabled:!0,className:"w-full bg-gray-400 text-white py-2 px-4 rounded-md cursor-not-allowed",children:d("manager.techManagement.inviteForm.smsInviteComingSoon")})]})]}),(0,c.jsx)("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:(0,c.jsx)("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:d("manager.techManagement.inviteForm.cancel")})})]})})};var G=a(5501),Y=a(6238),Q=a(5989),$=a(9265),X=a(343),Z=a(911);const ee=e=>{let{stats:t,setActiveTab:a,setShowInviteModal:s,setTriggerInvoiceModal:n}=e;const{t:i}=(0,r.ok)(),{user:l}=(0,o.As)();i("manager.totalTechnicians"),null===t||void 0===t||t.totalTechnicians,h.A,i("manager.activeTechnicians"),i("manager.totalWorkHours"),null===t||void 0===t||t.totalWorkHours,Q.A,i("manager.thisMonth"),i("manager.completedJobs"),null===t||void 0===t||t.completedJobs,R.A,i("manager.thisMonth");return(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,c.jsx)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(h.A,{className:"h-8 w-8 text-blue-400"})}),(0,c.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,c.jsxs)("dl",{children:[(0,c.jsx)("dt",{className:"text-sm font-medium text-gray-400 truncate",children:i("manager.totalTechnicians")}),(0,c.jsx)("dd",{className:"text-lg font-medium text-white",children:t.totalTechnicians})]})})]})}),(0,c.jsx)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(R.A,{className:"h-8 w-8 text-green-400"})}),(0,c.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,c.jsxs)("dl",{children:[(0,c.jsx)("dt",{className:"text-sm font-medium text-gray-400 truncate",children:i("manager.activeTickets")}),(0,c.jsx)("dd",{className:"text-lg font-medium text-white",children:t.activeTickets})]})})]})}),(0,c.jsx)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(k.A,{className:"h-8 w-8 text-yellow-400"})}),(0,c.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,c.jsxs)("dl",{children:[(0,c.jsx)("dt",{className:"text-sm font-medium text-gray-400 truncate",children:i("manager.pendingInvoices")}),(0,c.jsx)("dd",{className:"text-lg font-medium text-white",children:t.pendingInvoices})]})})]})}),(0,c.jsx)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)(Y.A,{className:"h-8 w-8 text-purple-400"})}),(0,c.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,c.jsxs)("dl",{children:[(0,c.jsx)("dt",{className:"text-sm font-medium text-gray-400 truncate",children:i("manager.companyStatus")}),(0,c.jsx)("dd",{className:"text-lg font-medium text-white",children:"Active"})]})})]})})]}),(0,c.jsx)(te,{setActiveTab:a,setShowInviteModal:s,setTriggerInvoiceModal:n})]})},te=e=>{let{setActiveTab:t,setShowInviteModal:a,setTriggerInvoiceModal:s}=e;const{t:n}=(0,r.ok)();return(0,c.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:n("manager.quickActions")}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,c.jsxs)("button",{className:"flex items-center p-4 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors duration-200",onClick:()=>a(!0),children:[(0,c.jsx)(h.A,{className:"h-5 w-5 text-white mr-3"}),(0,c.jsx)("span",{className:"text-white font-medium",children:n("manager.inviteTechnician")})]}),(0,c.jsxs)("button",{className:"flex items-center p-4 bg-green-600 hover:bg-green-700 rounded-lg transition-colors duration-200",onClick:()=>{t("invoicing"),s(!0)},children:[(0,c.jsx)(k.A,{className:"h-5 w-5 text-white mr-3"}),(0,c.jsx)("span",{className:"text-white font-medium",children:n("manager.createInvoice")})]}),(0,c.jsxs)("button",{className:"flex items-center p-4 bg-gray-500 hover:bg-gray-600 rounded-lg transition-colors duration-200",children:[(0,c.jsx)(Y.A,{className:"h-5 w-5 text-white mr-3"}),(0,c.jsx)("span",{className:"text-white font-medium",children:n("manager.updateCompany")})]}),(0,c.jsxs)("button",{className:"flex items-center p-4 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors duration-200",children:[(0,c.jsx)(R.A,{className:"h-5 w-5 text-white mr-3"}),(0,c.jsx)("span",{className:"text-white font-medium",children:n("audit.viewReports")})]}),(0,c.jsxs)("button",{className:"flex items-center p-4 bg-orange-600 hover:bg-orange-700 rounded-lg transition-colors duration-200",onClick:()=>t("jobTickets"),children:[(0,c.jsx)(R.A,{className:"h-5 w-5 text-white mr-3"}),(0,c.jsx)("span",{className:"text-white font-medium",children:n("manager.createJobTicket")})]}),(0,c.jsxs)("button",{className:"relative flex items-center p-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl overflow-hidden group",style:{background:"linear-gradient(135deg, #39b198 0%, #2d8a73 100%)",boxShadow:"0 4px 15px rgba(57, 177, 152, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:[(0,c.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-0 group-hover:opacity-20 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-all duration-700"}),(0,c.jsx)("svg",{className:"h-5 w-5 text-white mr-3 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,c.jsx)("span",{className:"text-white font-medium relative z-10",children:"PatchAI"})]})]})]})},ae=()=>{var e,t,a,i;const{t:l}=(0,r.ok)(),{hasManagerAccess:m,getTechnicianStats:u}=(0,n.zS)(),{validateAccess:x}=d(),{user:g,logout:p}=(0,o.As)(),[b,j]=(0,s.useState)("overview"),[f,N]=(0,s.useState)(!1),[w,_]=(0,s.useState)(null),[T,A]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),[F,M]=(0,s.useState)(!1),E=(0,s.useRef)(),I=(0,s.useRef)();(0,s.useEffect)((()=>{(async()=>{const{hasAccess:e,reason:t}=await x("manager_features");e?N(!0):_(t)})()}),[x]),(0,s.useEffect)((()=>{const e=e=>{window.innerWidth>=768||T&&I.current&&!I.current.contains(e.target)&&E.current&&!E.current.contains(e.target)&&A(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[T]);const O=[{id:"overview",label:l("manager.overview"),icon:G.A,component:(0,c.jsx)(ee,{stats:u(),setActiveTab:j,setShowInviteModal:S,setTriggerInvoiceModal:M})},{id:"invoicing",label:l("manager.invoicing.title"),icon:k.A,component:(0,c.jsx)(D,{triggerInvoiceModal:F,setTriggerInvoiceModal:M})},{id:"jobTickets",label:l("manager.jobTickets.title"),icon:R.A,component:(0,c.jsx)(V,{})},{id:"company",label:l("manager.company"),icon:Y.A,component:(0,c.jsx)(y,{})},{id:"technicians",label:l("manager.technicians"),icon:h.A,component:(0,c.jsx)(v,{})},{id:"audit",label:l("audit.title"),icon:Q.A,component:(0,c.jsx)(z,{})}];return w?(0,c.jsx)("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"text-red-400 text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,c.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:l("common.accessDenied")}),(0,c.jsx)("p",{className:"text-gray-400 mb-4",children:w}),(0,c.jsx)("p",{className:"text-gray-500",children:l("common.contactAdmin")})]})}):f?(0,c.jsxs)("div",{className:"bg-slate-900 min-h-screen",children:[(0,c.jsx)("div",{className:"h-14 relative",children:(0,c.jsx)(Z.A,{})}),(0,c.jsxs)("div",{className:"flex",children:[(0,c.jsx)("button",{ref:E,className:"md:hidden fixed top-4 left-4 z-50 p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700",onClick:()=>A(!T),children:(0,c.jsx)($.A,{className:"h-6 w-6","aria-hidden":"true"})}),(0,c.jsx)("div",{ref:I,className:"".concat(T?"translate-x-0":"-translate-x-full"," md:translate-x-0 transition-transform duration-300 ease-in-out fixed md:static inset-y-0 left-0 z-40 w-64 bg-gray-800 border-r border-gray-700 h-screen"),children:(0,c.jsxs)("div",{className:"flex h-full flex-col gap-y-3 md:gap-y-4 overflow-y-auto px-6 py-4 pt-16 md:pt-4",children:[(0,c.jsx)("div",{className:"flex h-16 shrink-0 items-center",children:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)(Y.A,{className:"h-8 w-8 text-blue-500 mr-3"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-white",children:(null===g||void 0===g?void 0:g.company_name)||l("manager.dashboard")}),(0,c.jsx)("p",{className:"text-sm text-gray-400",children:l("manager.portal")})]})]})}),(0,c.jsx)("nav",{className:"flex flex-1 flex-col",children:(0,c.jsxs)("ul",{className:"flex flex-1 flex-col gap-y-4 md:gap-y-5",children:[(0,c.jsx)("li",{children:(0,c.jsx)("ul",{className:"-mx-2 space-y-1",children:O.map((e=>{const t=e.icon;return(0,c.jsx)("li",{children:(0,c.jsxs)("button",{onClick:()=>{j(e.id),A(!1)},className:"".concat(b===e.id?"bg-gray-700 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"," group flex w-full gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold transition-colors duration-200"),children:[(0,c.jsx)(t,{className:"h-6 w-6 shrink-0","aria-hidden":"true"}),e.label]})},e.id)}))})}),(0,c.jsx)("li",{className:"mt-auto",children:(0,c.jsxs)("div",{className:"border-t border-gray-700 pt-3 md:pt-4",children:[(0,c.jsxs)("div",{className:"flex items-center gap-x-3 mb-2 md:mb-3",children:[(0,c.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-600",children:(0,c.jsx)("span",{className:"text-sm font-medium text-white",children:(null===g||void 0===g||null===(e=g.name)||void 0===e||null===(t=e.charAt(0))||void 0===t?void 0:t.toUpperCase())||"M"})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"text-sm font-medium text-white truncate",children:(null===g||void 0===g?void 0:g.name)||l("common.manager")}),(0,c.jsx)("p",{className:"text-xs text-gray-400 truncate",children:null===g||void 0===g?void 0:g.email})]})]}),(0,c.jsxs)("button",{onClick:p,className:"group flex w-full gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold text-gray-300 hover:text-white hover:bg-gray-700 transition-colors duration-200",children:[(0,c.jsx)(X.A,{className:"h-6 w-6 shrink-0","aria-hidden":"true"}),l("auth.logout")]})]})})]})})]})}),(0,c.jsx)("main",{className:"flex-1 bg-slate-900 p-6 overflow-y-auto text-white",children:(0,c.jsx)("div",{className:"mt-2 md:mt-0 pl-14 md:pl-0 md:ml-64",children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsx)("h1",{className:"text-3xl font-bold text-white",children:null===(a=O.find((e=>e.id===b)))||void 0===a?void 0:a.label}),(0,c.jsxs)("p",{className:"text-gray-400 mt-2",children:["overview"===b&&l("manager.dashboardSubtitle"),"technicians"===b&&l("manager.manageTechnicians"),"invoicing"===b&&l("manager.invoicing.subtitle"),"jobTickets"===b&&l("manager.jobTickets.subtitle"),"company"===b&&l("manager.manageCompany"),"audit"===b&&l("audit.viewLogs")]})]}),(0,c.jsx)("div",{className:"bg-gray-800 rounded-lg shadow-xl",children:null===(i=O.find((e=>e.id===b)))||void 0===i?void 0:i.component})]})})})]}),(0,c.jsx)(K,{isOpen:C,onClose:()=>S(!1),onSuccess:e=>{console.log("Technician invitation successful:",e)}})]}):(0,c.jsx)("div",{className:"bg-slate-900 min-h-screen flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,c.jsx)("p",{className:"text-gray-400",children:l("common.loading")})]})})}}}]);
//# sourceMappingURL=manager-dashboard.231eb39f.chunk.js.map